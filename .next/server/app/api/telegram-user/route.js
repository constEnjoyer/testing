"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/telegram-user/route";
exports.ids = ["app/api/telegram-user/route"];
exports.modules = {

/***/ "mongoose":
/*!***************************!*\
  !*** external "mongoose" ***!
  \***************************/
/***/ ((module) => {

module.exports = require("mongoose");

/***/ }),

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Ftelegram-user%2Froute&page=%2Fapi%2Ftelegram-user%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Ftelegram-user%2Froute.ts&appDir=C%3A%5CUsers%5Cconst%5CDesktop%5Ctonotchance-main%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Cconst%5CDesktop%5Ctonotchance-main&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!***************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Ftelegram-user%2Froute&page=%2Fapi%2Ftelegram-user%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Ftelegram-user%2Froute.ts&appDir=C%3A%5CUsers%5Cconst%5CDesktop%5Ctonotchance-main%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Cconst%5CDesktop%5Ctonotchance-main&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \***************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var C_Users_const_Desktop_tonotchance_main_src_app_api_telegram_user_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./src/app/api/telegram-user/route.ts */ \"(rsc)/./src/app/api/telegram-user/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/telegram-user/route\",\n        pathname: \"/api/telegram-user\",\n        filename: \"route\",\n        bundlePath: \"app/api/telegram-user/route\"\n    },\n    resolvedPagePath: \"C:\\\\Users\\\\const\\\\Desktop\\\\tonotchance-main\\\\src\\\\app\\\\api\\\\telegram-user\\\\route.ts\",\n    nextConfigOutput,\n    userland: C_Users_const_Desktop_tonotchance_main_src_app_api_telegram_user_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks } = routeModule;\nconst originalPathname = \"/api/telegram-user/route\";\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIuanM/bmFtZT1hcHAlMkZhcGklMkZ0ZWxlZ3JhbS11c2VyJTJGcm91dGUmcGFnZT0lMkZhcGklMkZ0ZWxlZ3JhbS11c2VyJTJGcm91dGUmYXBwUGF0aHM9JnBhZ2VQYXRoPXByaXZhdGUtbmV4dC1hcHAtZGlyJTJGYXBpJTJGdGVsZWdyYW0tdXNlciUyRnJvdXRlLnRzJmFwcERpcj1DJTNBJTVDVXNlcnMlNUNjb25zdCU1Q0Rlc2t0b3AlNUN0b25vdGNoYW5jZS1tYWluJTVDc3JjJTVDYXBwJnBhZ2VFeHRlbnNpb25zPXRzeCZwYWdlRXh0ZW5zaW9ucz10cyZwYWdlRXh0ZW5zaW9ucz1qc3gmcGFnZUV4dGVuc2lvbnM9anMmcm9vdERpcj1DJTNBJTVDVXNlcnMlNUNjb25zdCU1Q0Rlc2t0b3AlNUN0b25vdGNoYW5jZS1tYWluJmlzRGV2PXRydWUmdHNjb25maWdQYXRoPXRzY29uZmlnLmpzb24mYmFzZVBhdGg9JmFzc2V0UHJlZml4PSZuZXh0Q29uZmlnT3V0cHV0PSZwcmVmZXJyZWRSZWdpb249Jm1pZGRsZXdhcmVDb25maWc9ZTMwJTNEISIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7QUFBc0c7QUFDdkM7QUFDYztBQUNtQztBQUNoSDtBQUNBO0FBQ0E7QUFDQSx3QkFBd0IsZ0hBQW1CO0FBQzNDO0FBQ0EsY0FBYyx5RUFBUztBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsWUFBWTtBQUNaLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQSxRQUFRLGlFQUFpRTtBQUN6RTtBQUNBO0FBQ0EsV0FBVyw0RUFBVztBQUN0QjtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ3VIOztBQUV2SCIsInNvdXJjZXMiOlsid2VicGFjazovL25leHRqcy10ZW1wbGF0ZS8/MDQ0YyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBcHBSb3V0ZVJvdXRlTW9kdWxlIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLW1vZHVsZXMvYXBwLXJvdXRlL21vZHVsZS5jb21waWxlZFwiO1xuaW1wb3J0IHsgUm91dGVLaW5kIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLWtpbmRcIjtcbmltcG9ydCB7IHBhdGNoRmV0Y2ggYXMgX3BhdGNoRmV0Y2ggfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9saWIvcGF0Y2gtZmV0Y2hcIjtcbmltcG9ydCAqIGFzIHVzZXJsYW5kIGZyb20gXCJDOlxcXFxVc2Vyc1xcXFxjb25zdFxcXFxEZXNrdG9wXFxcXHRvbm90Y2hhbmNlLW1haW5cXFxcc3JjXFxcXGFwcFxcXFxhcGlcXFxcdGVsZWdyYW0tdXNlclxcXFxyb3V0ZS50c1wiO1xuLy8gV2UgaW5qZWN0IHRoZSBuZXh0Q29uZmlnT3V0cHV0IGhlcmUgc28gdGhhdCB3ZSBjYW4gdXNlIHRoZW0gaW4gdGhlIHJvdXRlXG4vLyBtb2R1bGUuXG5jb25zdCBuZXh0Q29uZmlnT3V0cHV0ID0gXCJcIlxuY29uc3Qgcm91dGVNb2R1bGUgPSBuZXcgQXBwUm91dGVSb3V0ZU1vZHVsZSh7XG4gICAgZGVmaW5pdGlvbjoge1xuICAgICAgICBraW5kOiBSb3V0ZUtpbmQuQVBQX1JPVVRFLFxuICAgICAgICBwYWdlOiBcIi9hcGkvdGVsZWdyYW0tdXNlci9yb3V0ZVwiLFxuICAgICAgICBwYXRobmFtZTogXCIvYXBpL3RlbGVncmFtLXVzZXJcIixcbiAgICAgICAgZmlsZW5hbWU6IFwicm91dGVcIixcbiAgICAgICAgYnVuZGxlUGF0aDogXCJhcHAvYXBpL3RlbGVncmFtLXVzZXIvcm91dGVcIlxuICAgIH0sXG4gICAgcmVzb2x2ZWRQYWdlUGF0aDogXCJDOlxcXFxVc2Vyc1xcXFxjb25zdFxcXFxEZXNrdG9wXFxcXHRvbm90Y2hhbmNlLW1haW5cXFxcc3JjXFxcXGFwcFxcXFxhcGlcXFxcdGVsZWdyYW0tdXNlclxcXFxyb3V0ZS50c1wiLFxuICAgIG5leHRDb25maWdPdXRwdXQsXG4gICAgdXNlcmxhbmRcbn0pO1xuLy8gUHVsbCBvdXQgdGhlIGV4cG9ydHMgdGhhdCB3ZSBuZWVkIHRvIGV4cG9zZSBmcm9tIHRoZSBtb2R1bGUuIFRoaXMgc2hvdWxkXG4vLyBiZSBlbGltaW5hdGVkIHdoZW4gd2UndmUgbW92ZWQgdGhlIG90aGVyIHJvdXRlcyB0byB0aGUgbmV3IGZvcm1hdC4gVGhlc2Vcbi8vIGFyZSB1c2VkIHRvIGhvb2sgaW50byB0aGUgcm91dGUuXG5jb25zdCB7IHJlcXVlc3RBc3luY1N0b3JhZ2UsIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2UsIHNlcnZlckhvb2tzIH0gPSByb3V0ZU1vZHVsZTtcbmNvbnN0IG9yaWdpbmFsUGF0aG5hbWUgPSBcIi9hcGkvdGVsZWdyYW0tdXNlci9yb3V0ZVwiO1xuZnVuY3Rpb24gcGF0Y2hGZXRjaCgpIHtcbiAgICByZXR1cm4gX3BhdGNoRmV0Y2goe1xuICAgICAgICBzZXJ2ZXJIb29rcyxcbiAgICAgICAgc3RhdGljR2VuZXJhdGlvbkFzeW5jU3RvcmFnZVxuICAgIH0pO1xufVxuZXhwb3J0IHsgcm91dGVNb2R1bGUsIHJlcXVlc3RBc3luY1N0b3JhZ2UsIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2UsIHNlcnZlckhvb2tzLCBvcmlnaW5hbFBhdGhuYW1lLCBwYXRjaEZldGNoLCAgfTtcblxuLy8jIHNvdXJjZU1hcHBpbmdVUkw9YXBwLXJvdXRlLmpzLm1hcCJdLCJuYW1lcyI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Ftelegram-user%2Froute&page=%2Fapi%2Ftelegram-user%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Ftelegram-user%2Froute.ts&appDir=C%3A%5CUsers%5Cconst%5CDesktop%5Ctonotchance-main%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Cconst%5CDesktop%5Ctonotchance-main&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./src/app/api/telegram-user/route.ts":
/*!********************************************!*\
  !*** ./src/app/api/telegram-user/route.ts ***!
  \********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   POST: () => (/* binding */ POST),\n/* harmony export */   dynamic: () => (/* binding */ dynamic)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/next/dist/api/server.js\");\n/* harmony import */ var _lib_db__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/db */ \"(rsc)/./src/lib/db.js\");\n/* harmony import */ var _models_User__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/models/User */ \"(rsc)/./src/models/User.js\");\n/* harmony import */ var _models_Referral__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @/models/Referral */ \"(rsc)/./src/models/Referral.js\");\n\n\n\n\nconst dynamic = \"force-dynamic\";\n/**\n * Создает или обновляет пользователя Telegram\n */ async function createTelegramUser(telegramId, userData) {\n    console.log(\"[API telegram-user] \\uD83D\\uDCDD Создание/обновление пользователя:\", {\n        telegramId\n    });\n    const user = await _models_User__WEBPACK_IMPORTED_MODULE_2__[\"default\"].findOne({\n        telegramId\n    });\n    if (user) {\n        console.log(\"[API telegram-user] ✏️ Обновление существующего пользователя\");\n        // Обновляем существующего пользователя\n        user.firstName = userData.firstName || user.firstName;\n        user.lastName = userData.lastName || user.lastName;\n        user.username = userData.username || user.username;\n        user.photoUrl = userData.photoUrl || user.photoUrl;\n        user.chatId = userData.chatId || user.chatId;\n        await user.save();\n        return user;\n    }\n    console.log(\"[API telegram-user] ➕ Создание нового пользователя\");\n    // Создаем нового пользователя\n    const newUser = await _models_User__WEBPACK_IMPORTED_MODULE_2__[\"default\"].create({\n        telegramId,\n        firstName: userData.firstName || \"\",\n        lastName: userData.lastName || \"\",\n        username: userData.username || \"\",\n        photoUrl: userData.photoUrl || \"\",\n        chatId: userData.chatId || \"\",\n        referralCode: `${telegramId.slice(-5)}_${Math.random().toString(36).substring(2, 7)}`,\n        tickets: 0,\n        tonotChanceTickets: 0,\n        balance: 0,\n        tonBalance: 0,\n        lastActive: new Date()\n    });\n    console.log(\"[API telegram-user] ✅ Пользователь создан:\", {\n        id: newUser.telegramId\n    });\n    return newUser;\n}\n/**\n * Регистрирует реферальную связь\n */ async function registerReferral(telegramId, startParam) {\n    console.log(\"[API telegram-user] \\uD83D\\uDD04 Регистрация реферала:\", {\n        telegramId,\n        startParam\n    });\n    // Проверяем существование реферера\n    const referer = await _models_User__WEBPACK_IMPORTED_MODULE_2__[\"default\"].findOne({\n        referralCode: startParam\n    });\n    if (!referer) {\n        console.log(\"[API telegram-user] ❌ Реферер не найден:\", startParam);\n        throw new Error(\"Invalid referral code\");\n    }\n    console.log(\"[API telegram-user] ✅ Найден реферер:\", {\n        id: referer.telegramId,\n        code: startParam\n    });\n    // Проверяем самореферальность\n    if (referer.telegramId === telegramId) {\n        console.log(\"[API telegram-user] ❌ Попытка самореферальности:\", telegramId);\n        throw new Error(\"Cannot register your own referral code\");\n    }\n    // Проверяем существующую связь\n    const existingReferral = await _models_Referral__WEBPACK_IMPORTED_MODULE_3__[\"default\"].findOne({\n        refererId: referer.telegramId,\n        referralId: telegramId\n    });\n    if (existingReferral) {\n        console.log(\"[API telegram-user] ℹ️ Связь уже существует:\", {\n            refererId: existingReferral.refererId,\n            referralId: existingReferral.referralId,\n            isValid: existingReferral.isValid\n        });\n        return existingReferral;\n    }\n    // Получаем данные реферала\n    const referal = await _models_User__WEBPACK_IMPORTED_MODULE_2__[\"default\"].findOne({\n        telegramId\n    });\n    if (!referal) {\n        console.log(\"[API telegram-user] ❌ Реферал не найден:\", telegramId);\n        throw new Error(\"Referral user not found\");\n    }\n    // Создаем новую реферальную связь\n    console.log(\"[API telegram-user] \\uD83D\\uDCDD Создание новой реферальной связи\");\n    const newReferral = new _models_Referral__WEBPACK_IMPORTED_MODULE_3__[\"default\"]({\n        refererId: referer.telegramId,\n        referralId: telegramId,\n        username: referal.username,\n        firstName: referal.firstName,\n        lastName: referal.lastName,\n        photoUrl: referal.photoUrl,\n        hasPlayedRoomA: false,\n        hasPlayedRoomB: false,\n        isValid: false,\n        createdAt: new Date()\n    });\n    await newReferral.save();\n    console.log(\"[API telegram-user] ✅ Реферальная связь создана:\", {\n        id: newReferral._id,\n        refererId: newReferral.refererId,\n        referralId: newReferral.referralId\n    });\n    // Обновляем список рефералов у реферера\n    if (!referer.referrals) {\n        referer.referrals = [];\n    }\n    referer.referrals.push({\n        userId: telegramId,\n        username: referal.username,\n        photoUrl: referal.photoUrl,\n        roomAPlayed: false,\n        roomBPlayed: false,\n        isValid: false\n    });\n    await referer.save();\n    console.log(\"[API telegram-user] ✅ Профиль реферера обновлен:\", {\n        refererId: referer.telegramId,\n        referralsCount: referer.referrals.length\n    });\n    return newReferral;\n}\n/**\n * Получает пользователя с информацией о рефералах\n */ async function getUserWithReferrals(telegramId) {\n    console.log(\"[API telegram-user] \\uD83D\\uDD0D Получение данных пользователя с рефералами:\", telegramId);\n    const user = await _models_User__WEBPACK_IMPORTED_MODULE_2__[\"default\"].findOne({\n        telegramId\n    });\n    if (!user) {\n        throw new Error(\"User not found\");\n    }\n    return user;\n}\nasync function POST(req) {\n    console.log(\"[API telegram-user] \\uD83D\\uDCE5 Начало обработки запроса\");\n    try {\n        // 1. Логируем все заголовки запроса\n        const headers = {\n            contentType: req.headers.get(\"content-type\"),\n            userAgent: req.headers.get(\"user-agent\"),\n            referer: req.headers.get(\"referer\")\n        };\n        console.log(\"[API telegram-user] \\uD83D\\uDCCB Headers:\", headers);\n        // 2. Получаем и логируем URL параметры из referer\n        const refererUrl = headers.referer ? new URL(headers.referer) : null;\n        const startParamFromReferer = refererUrl?.searchParams.get(\"tgWebAppStartParam\");\n        console.log(\"[API telegram-user] \\uD83D\\uDD0D Параметры из referer:\", {\n            startParamFromReferer,\n            fullRefererUrl: headers.referer\n        });\n        const body = await req.json();\n        console.log(\"[API telegram-user] \\uD83D\\uDCE5 Тело запроса:\", {\n            id: body.id,\n            startParam: body.startParam,\n            hasStartParam: !!body.startParam\n        });\n        // Используем startParam из тела запроса или из referer\n        const startParam = body.startParam || startParamFromReferer;\n        // 3. Логируем полное тело запроса\n        console.log(\"[API telegram-user] \\uD83D\\uDCE6 Полное тело запроса:\", body);\n        // 4. Проверяем все возможные источники startParam\n        const startParamSources = {\n            fromBody: body.startParam,\n            fromStartParam: body.start_param,\n            fromWebApp: body.tgWebAppStartParam,\n            fromWebAppData: body.webAppData?.start_param,\n            fromReferer: startParamFromReferer\n        };\n        console.log(\"[API telegram-user] \\uD83D\\uDD0D Все источники startParam:\", startParamSources);\n        // 5. Определяем итоговый startParam\n        const finalStartParam = startParamSources.fromBody || startParamSources.fromStartParam || startParamSources.fromWebApp || startParamSources.fromWebAppData || startParamSources.fromReferer;\n        console.log(\"[API telegram-user] ✨ Итоговый startParam:\", finalStartParam);\n        // Поддерживаем оба формата данных\n        const telegramId = body.telegramId || body.id;\n        const userData = {\n            firstName: body.firstName || body.first_name,\n            lastName: body.lastName || body.last_name,\n            username: body.username,\n            chatId: body.chatId || body.telegram_chat_id\n        };\n        if (!telegramId) {\n            console.log(\"[API telegram-user] ❌ Отсутствует telegramId\");\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                error: \"Telegram ID is required\"\n            }, {\n                status: 400\n            });\n        }\n        await (0,_lib_db__WEBPACK_IMPORTED_MODULE_1__.connectToDatabase)();\n        // 1. Создаем/обновляем пользователя\n        const user = await createTelegramUser(String(telegramId), userData);\n        // 2. Если есть startParam, регистрируем реферала\n        let referral = null;\n        if (finalStartParam) {\n            try {\n                console.log(\"[API telegram-user] \\uD83C\\uDFAF Попытка регистрации реферала:\", {\n                    telegramId,\n                    startParam: finalStartParam,\n                    userData\n                });\n                referral = await registerReferral(String(telegramId), finalStartParam);\n            } catch (refError) {\n                console.error(\"[API telegram-user] ❌ Ошибка при регистрации реферала:\", refError);\n            }\n        } else {\n            console.log(\"[API telegram-user] ℹ️ startParam отсутствует, пропускаем регистрацию реферала\");\n        }\n        // 3. Получаем обновленные данные пользователя\n        const updatedUser = await getUserWithReferrals(String(telegramId));\n        console.log(\"[API telegram-user] ✅ Запрос обработан успешно:\", {\n            userId: telegramId,\n            hasStartParam: !!finalStartParam,\n            hasReferral: !!referral,\n            referralStatus: referral ? {\n                isValid: referral.isValid,\n                hasPlayedRoomA: referral.hasPlayedRoomA,\n                hasPlayedRoomB: referral.hasPlayedRoomB\n            } : null\n        });\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            success: true,\n            data: updatedUser,\n            referral: referral\n        });\n    } catch (error) {\n        console.error(\"[API telegram-user] ❌ Ошибка:\", error);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            success: false,\n            error: error instanceof Error ? error.message : \"Failed to process user\"\n        }, {\n            status: 500\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvYXBwL2FwaS90ZWxlZ3JhbS11c2VyL3JvdXRlLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7OztBQUF3RDtBQUNYO0FBQ1o7QUFDUTtBQUVsQyxNQUFNSSxVQUFVLGdCQUFnQjtBQUV2Qzs7Q0FFQyxHQUNELGVBQWVDLG1CQUFtQkMsVUFBa0IsRUFBRUMsUUFBYTtJQUNqRUMsUUFBUUMsR0FBRyxDQUFDLHNFQUE0RDtRQUFFSDtJQUFXO0lBRXJGLE1BQU1JLE9BQU8sTUFBTVIsb0RBQUlBLENBQUNTLE9BQU8sQ0FBQztRQUFFTDtJQUFXO0lBRTdDLElBQUlJLE1BQU07UUFDUkYsUUFBUUMsR0FBRyxDQUFDO1FBQ1osdUNBQXVDO1FBQ3ZDQyxLQUFLRSxTQUFTLEdBQUdMLFNBQVNLLFNBQVMsSUFBSUYsS0FBS0UsU0FBUztRQUNyREYsS0FBS0csUUFBUSxHQUFHTixTQUFTTSxRQUFRLElBQUlILEtBQUtHLFFBQVE7UUFDbERILEtBQUtJLFFBQVEsR0FBR1AsU0FBU08sUUFBUSxJQUFJSixLQUFLSSxRQUFRO1FBQ2xESixLQUFLSyxRQUFRLEdBQUdSLFNBQVNRLFFBQVEsSUFBSUwsS0FBS0ssUUFBUTtRQUNsREwsS0FBS00sTUFBTSxHQUFHVCxTQUFTUyxNQUFNLElBQUlOLEtBQUtNLE1BQU07UUFDNUMsTUFBTU4sS0FBS08sSUFBSTtRQUNmLE9BQU9QO0lBQ1Q7SUFFQUYsUUFBUUMsR0FBRyxDQUFDO0lBQ1osOEJBQThCO0lBQzlCLE1BQU1TLFVBQVUsTUFBTWhCLG9EQUFJQSxDQUFDaUIsTUFBTSxDQUFDO1FBQ2hDYjtRQUNBTSxXQUFXTCxTQUFTSyxTQUFTLElBQUk7UUFDakNDLFVBQVVOLFNBQVNNLFFBQVEsSUFBSTtRQUMvQkMsVUFBVVAsU0FBU08sUUFBUSxJQUFJO1FBQy9CQyxVQUFVUixTQUFTUSxRQUFRLElBQUk7UUFDL0JDLFFBQVFULFNBQVNTLE1BQU0sSUFBSTtRQUMzQkksY0FBYyxDQUFDLEVBQUVkLFdBQVdlLEtBQUssQ0FBQyxD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Z0JBQ0Z2RSxRQUFRQyxHQUFHLENBQUMsa0VBQXdEO29CQUNwRUg7b0JBQ0U0QixZQUFZNkM7b0JBQ1p4RTtnQkFDRjtnQkFDQWdGLFdBQVcsTUFBTXRELGlCQUFpQnFELE9BQU9oRixhQUFheUU7WUFDeEQsRUFBRSxPQUFPUyxVQUFVO2dCQUNqQmhGLFFBQVE0RSxLQUFLLENBQUMsMERBQTBESTtZQUMxRTtRQUNGLE9BQU87WUFDTGhGLFFBQVFDLEdBQUcsQ0FBQztRQUNkO1FBRUEsOENBQThDO1FBQzlDLE1BQU1nRixjQUFjLE1BQU1sQyxxQkFBcUIrQixPQUFPaEY7UUFFdERFLFFBQVFDLEdBQUcsQ0FBQyxtREFBbUQ7WUFDN0R5QyxRQUFRNUM7WUFDUitELGVBQWUsQ0FBQyxDQUFDVTtZQUNqQlcsYUFBYSxDQUFDLENBQUNIO1lBQ2ZJLGdCQUFnQkosV0FBVztnQkFDekI5QyxTQUFTOEMsU0FBUzlDLE9BQU87Z0JBQ3pCRyxnQkFBZ0IyQyxTQUFTM0MsY0FBYztnQkFDdkNDLGdCQUFnQjBDLFNBQVMxQyxjQUFjO1lBQ3pDLElBQUk7UUFDTjtRQUVBLE9BQU83QyxxREFBWUEsQ0FBQ29FLElBQUksQ0FBQztZQUN2QmUsU0FBUztZQUNUUyxNQUFNSDtZQUNORixVQUFVQTtRQUNaO0lBQ0YsRUFBRSxPQUFPSCxPQUFPO1FBQ2Q1RSxRQUFRNEUsS0FBSyxDQUFDLGlDQUFpQ0E7UUFDL0MsT0FBT3BGLHFEQUFZQSxDQUFDb0UsSUFBSSxDQUFDO1lBQ3ZCZSxTQUFTO1lBQ1RDLE9BQU9BLGlCQUFpQmhELFFBQVFnRCxNQUFNUyxPQUFPLEdBQUc7UUFDbEQsR0FBRztZQUFFUixRQUFRO1FBQUk7SUFDbkI7QUFDRiIsInNvdXJjZXMiOlsid2VicGFjazovL25leHRqcy10ZW1wbGF0ZS8uL3NyYy9hcHAvYXBpL3RlbGVncmFtLXVzZXIvcm91dGUudHM/MzIxYyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBOZXh0UmVxdWVzdCwgTmV4dFJlc3BvbnNlIH0gZnJvbSAnbmV4dC9zZXJ2ZXInO1xuaW1wb3J0IHsgY29ubmVjdFRvRGF0YWJhc2UgfSBmcm9tICdAL2xpYi9kYic7XG5pbXBvcnQgVXNlciBmcm9tICdAL21vZGVscy9Vc2VyJztcbmltcG9ydCBSZWZlcnJhbCBmcm9tICdAL21vZGVscy9SZWZlcnJhbCc7XG5cbmV4cG9ydCBjb25zdCBkeW5hbWljID0gJ2ZvcmNlLWR5bmFtaWMnO1xuXG4vKipcbiAqINCh0L7Qt9C00LDQtdGCINC40LvQuCDQvtCx0L3QvtCy0LvRj9C10YIg0L/QvtC70YzQt9C+0LLQsNGC0LXQu9GPIFRlbGVncmFtXG4gKi9cbmFzeW5jIGZ1bmN0aW9uIGNyZWF0ZVRlbGVncmFtVXNlcih0ZWxlZ3JhbUlkOiBzdHJpbmcsIHVzZXJEYXRhOiBhbnkpIHtcbiAgY29uc29sZS5sb2coJ1tBUEkgdGVsZWdyYW0tdXNlcl0g8J+TnSDQodC+0LfQtNCw0L3QuNC1L9C+0LHQvdC+0LLQu9C10L3QuNC1INC/0L7Qu9GM0LfQvtCy0LDRgtC10LvRjzonLCB7IHRlbGVncmFtSWQgfSk7XG4gIFxuICBjb25zdCB1c2VyID0gYXdhaXQgVXNlci5maW5kT25lKHsgdGVsZWdyYW1JZCB9KTtcbiAgXG4gIGlmICh1c2VyKSB7XG4gICAgY29uc29sZS5sb2coJ1tBUEkgdGVsZWdyYW0tdXNlcl0g4pyP77iPINCe0LHQvdC+0LLQu9C10L3QuNC1INGB0YPRidC10YHRgtCy0YPRjtGJ0LXQs9C+INC/0L7Qu9GM0LfQvtCy0LDRgtC10LvRjycpO1xuICAgIC8vINCe0LHQvdC+0LLQu9GP0LXQvCDRgdGD0YnQtdGB0YLQstGD0Y7RidC10LPQviDQv9C+0LvRjNC30L7QstCw0YLQtdC70Y9cbiAgICB1c2VyLmZpcnN0TmFtZSA9IHVzZXJEYXRhLmZpcnN0TmFtZSB8fCB1c2VyLmZpcnN0TmFtZTtcbiAgICB1c2VyLmxhc3ROYW1lID0gdXNlckRhdGEubGFzdE5hbWUgfHwgdXNlci5sYXN0TmFtZTtcbiAgICB1c2VyLnVzZXJuYW1lID0gdXNlckRhdGEudXNlcm5hbWUgfHwgdXNlci51c2VybmFtZTtcbiAgICB1c2VyLnBob3RvVXJsID0gdXNlckRhdGEucGhvdG9VcmwgfHwgdXNlci5waG90b1VybDtcbiAgICB1c2VyLmNoYXRJZCA9IHVzZXJEYXRhLmNoYXRJZCB8fCB1c2VyLmNoYXRJZDtcbiAgICBhd2FpdCB1c2VyLnNhdmUoKTtcbiAgICByZXR1cm4gdXNlcjtcbiAgfVxuXG4gIGNvbnNvbGUubG9nKCdbQVBJIHRlbGVncmFtLXVzZXJdIOKelSDQodC+0LfQtNCw0L3QuNC1INC90L7QstC+0LPQviDQv9C+0LvRjNC30L7QstCw0YLQtdC70Y8nKTtcbiAgLy8g0KHQvtC30LTQsNC10Lwg0L3QvtCy0L7Qs9C+INC/0L7Qu9GM0LfQvtCy0LDRgtC10LvRj1xuICBjb25zdCBuZXdVc2VyID0gYXdhaXQgVXNlci5jcmVhdGUoe1xuICAgIHRlbGVncmFtSWQsXG4gICAgZmlyc3ROYW1lOiB1c2VyRGF0YS5maXJzdE5hbWUgfHwgJycsXG4gICAgbGFzdE5hbWU6IHVzZXJEYXRhLmxhc3ROYW1lIHx8ICcnLFxuICAgIHVzZXJuYW1lOiB1c2VyRGF0YS51c2VybmFtZSB8fCAnJyxcbiAgICBwaG90b1VybDogdXNlckRhdGEucGhvdG9VcmwgfHwgJycsXG4gICAgY2hhdElkOiB1c2VyRGF0YS5jaGF0SWQgfHwgJycsXG4gICAgcmVmZXJyYWxDb2RlOiBgJHt0ZWxlZ3JhbUlkLnNsaWNlKC01KX1fJHtNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zdWJzdHJpbmcoMiwgNyl9YCxcbiAgICB0aWNrZXRzOiAwLFxuICAgIHRvbm90Q2hhbmNlVGlja2V0czogMCxcbiAgICBiYWxhbmNlOiAwLFxuICAgIHRvbkJhbGFuY2U6IDAsXG4gICAgbGFzdEFjdGl2ZTogbmV3IERhdGUoKVxuICB9KTtcblxuICBjb25zb2xlLmxvZygnW0FQSSB0ZWxlZ3JhbS11c2VyXSDinIUg0J/QvtC70YzQt9C+0LLQsNGC0LXQu9GMINGB0L7Qt9C00LDQvTonLCB7IGlkOiBuZXdVc2VyLnRlbGVncmFtSWQgfSk7XG4gIHJldHVybiBuZXdVc2VyO1xufVxuXG4vKipcbiAqINCg0LXQs9C40YHRgtGA0LjRgNGD0LXRgiDRgNC10YTQtdGA0LDQu9GM0L3Rg9GOINGB0LLRj9C30YxcbiAqL1xuYXN5bmMgZnVuY3Rpb24gcmVnaXN0ZXJSZWZlcnJhbCh0ZWxlZ3JhbUlkOiBzdHJpbmcsIHN0YXJ0UGFyYW06IHN0cmluZykge1xuICBjb25zb2xlLmxvZygnW0FQSSB0ZWxlZ3JhbS11c2VyXSDwn5SEINCg0LXQs9C40YHRgtGA0LDRhtC40Y8g0YDQtdGE0LXRgNCw0LvQsDonLCB7IHRlbGVncmFtSWQsIHN0YXJ0UGFyYW0gfSk7XG5cbiAgLy8g0J/RgNC+0LLQtdGA0Y/QtdC8INGB0YPRidC10YHRgtCy0L7QstCw0L3QuNC1INGA0LXRhNC10YDQtdGA0LBcbiAgY29uc3QgcmVmZXJlciA9IGF3YWl0IFVzZXIuZmluZE9uZSh7IHJlZmVycmFsQ29kZTogc3RhcnRQYXJhbSB9KTtcbiAgaWYgKCFyZWZlcmVyKSB7XG4gICAgY29uc29sZS5sb2coJ1tBUEkgdGVsZWdyYW0tdXNlcl0g4p2MINCg0LXRhNC10YDQtdGAINC90LUg0L3QsNC50LTQtdC9OicsIHN0YXJ0UGFyYW0pO1xuICAgIHRocm93IG5ldyBFcnJvcignSW52YWxpZCByZWZlcnJhbCBjb2RlJyk7XG4gIH1cbiAgY29uc29sZS5sb2coJ1tBUEkgdGVsZWdyYW0tdXNlcl0g4pyFINCd0LDQudC00LXQvSDRgNC10YTQtdGA0LXRgDonLCB7XG4gICAgaWQ6IHJlZmVyZXIudGVsZWdyYW1JZCxcbiAgICBjb2RlOiBzdGFydFBhcmFtXG4gIH0pO1xuXG4gIC8vINCf0YDQvtCy0LXRgNGP0LXQvCDRgdCw0LzQvtGA0LXRhNC10YDQsNC70YzQvdC+0YHRgtGMXG4gIGlmIChyZWZlcmVyLnRlbGVncmFtSWQgPT09IHRlbGVncmFtSWQpIHtcbiAgICBjb25zb2xlLmxvZygnW0FQSSB0ZWxlZ3JhbS11c2VyXSDinYwg0J/QvtC/0YvRgtC60LAg0YHQsNC80L7RgNC10YTQtdGA0LDQu9GM0L3QvtGB0YLQuDonLCB0ZWxlZ3JhbUlkKTtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ0Nhbm5vdCByZWdpc3RlciB5b3VyIG93biByZWZlcnJhbCBjb2RlJyk7XG4gIH1cblxuICAvLyDQn9GA0L7QstC10YDRj9C10Lwg0YHRg9GJ0LXRgdGC0LLRg9GO0YnRg9GOINGB0LLRj9C30YxcbiAgY29uc3QgZXhpc3RpbmdSZWZlcnJhbCA9IGF3YWl0IFJlZmVycmFsLmZpbmRPbmUoe1xuICAgIHJlZmVyZXJJZDogcmVmZXJlci50ZWxlZ3JhbUlkLFxuICAgIHJlZmVycmFsSWQ6IHRlbGVncmFtSWRcbiAgfSk7XG5cbiAgaWYgKGV4aXN0aW5nUmVmZXJyYWwpIHtcbiAgICBjb25zb2xlLmxvZygnW0FQSSB0ZWxlZ3JhbS11c2VyXSDihLnvuI8g0KHQstGP0LfRjCDRg9C20LUg0YHRg9GJ0LXRgdGC0LLRg9C10YI6Jywge1xuICAgICAgcmVmZXJlcklkOiBleGlzdGluZ1JlZmVycmFsLnJlZmVyZXJJZCxcbiAgICAgIHJlZmVycmFsSWQ6IGV4aXN0aW5nUmVmZXJyYWwucmVmZXJyYWxJZCxcbiAgICAgIGlzVmFsaWQ6IGV4aXN0aW5nUmVmZXJyYWwuaXNWYWxpZFxuICAgIH0pO1xuICAgIHJldHVybiBleGlzdGluZ1JlZmVycmFsO1xuICB9XG5cbiAgLy8g0J/QvtC70YPRh9Cw0LXQvCDQtNCw0L3QvdGL0LUg0YDQtdGE0LXRgNCw0LvQsFxuICBjb25zdCByZWZlcmFsID0gYXdhaXQgVXNlci5maW5kT25lKHsgdGVsZWdyYW1JZCB9KTtcbiAgaWYgKCFyZWZlcmFsKSB7XG4gICAgY29uc29sZS5sb2coJ1tBUEkgdGVsZWdyYW0tdXNlcl0g4p2MINCg0LXRhNC10YDQsNC7INC90LUg0L3QsNC50LTQtdC9OicsIHRlbGVncmFtSWQpO1xuICAgIHRocm93IG5ldyBFcnJvcignUmVmZXJyYWwgdXNlciBub3QgZm91bmQnKTtcbiAgfVxuXG4gIC8vINCh0L7Qt9C00LDQtdC8INC90L7QstGD0Y4g0YDQtdGE0LXRgNCw0LvRjNC90YPRjiDRgdCy0Y/Qt9GMXG4gIGNvbnNvbGUubG9nKCdbQVBJIHRlbGVncmFtLXVzZXJdIPCfk50g0KHQvtC30LTQsNC90LjQtSDQvdC+0LLQvtC5INGA0LXRhNC10YDQsNC70YzQvdC+0Lkg0YHQstGP0LfQuCcpO1xuICBjb25zdCBuZXdSZWZlcnJhbCA9IG5ldyBSZWZlcnJhbCh7XG4gICAgcmVmZXJlcklkOiByZWZlcmVyLnRlbGVncmFtSWQsXG4gICAgcmVmZXJyYWxJZDogdGVsZWdyYW1JZCxcbiAgICB1c2VybmFtZTogcmVmZXJhbC51c2VybmFtZSxcbiAgICBmaXJzdE5hbWU6IHJlZmVyYWwuZmlyc3ROYW1lLFxuICAgIGxhc3ROYW1lOiByZWZlcmFsLmxhc3ROYW1lLFxuICAgIHBob3RvVXJsOiByZWZlcmFsLnBob3RvVXJsLFxuICAgIGhhc1BsYXllZFJvb21BOiBmYWxzZSxcbiAgICBoYXNQbGF5ZWRSb29tQjogZmFsc2UsXG4gICAgaXNWYWxpZDogZmFsc2UsXG4gICAgY3JlYXRlZEF0OiBuZXcgRGF0ZSgpXG4gIH0pO1xuXG4gIGF3YWl0IG5ld1JlZmVycmFsLnNhdmUoKTtcbiAgY29uc29sZS5sb2coJ1tBUEkgdGVsZWdyYW0tdXNlcl0g4pyFINCg0LXRhNC10YDQsNC70YzQvdCw0Y8g0YHQstGP0LfRjCDRgdC+0LfQtNCw0L3QsDonLCB7XG4gICAgaWQ6IG5ld1JlZmVycmFsLl9pZCxcbiAgICByZWZlcmVySWQ6IG5ld1JlZmVycmFsLnJlZmVyZXJJZCxcbiAgICByZWZlcnJhbElkOiBuZXdSZWZlcnJhbC5yZWZlcnJhbElkXG4gIH0pO1xuXG4gIC8vINCe0LHQvdC+0LLQu9GP0LXQvCDRgdC/0LjRgdC+0Log0YDQtdGE0LXRgNCw0LvQvtCyINGDINGA0LXRhNC10YDQtdGA0LBcbiAgaWYgKCFyZWZlcmVyLnJlZmVycmFscykge1xuICAgIHJlZmVyZXIucmVmZXJyYWxzID0gW107XG4gIH1cblxuICByZWZlcmVyLnJlZmVycmFscy5wdXNoKHtcbiAgICB1c2VySWQ6IHRlbGVncmFtSWQsXG4gICAgdXNlcm5hbWU6IHJlZmVyYWwudXNlcm5hbWUsXG4gICAgcGhvdG9Vcmw6IHJlZmVyYWwucGhvdG9VcmwsXG4gICAgcm9vbUFQbGF5ZWQ6IGZhbHNlLFxuICAgIHJvb21CUGxheWVkOiBmYWxzZSxcbiAgICBpc1ZhbGlkOiBmYWxzZVxuICB9KTtcblxuICBhd2FpdCByZWZlcmVyLnNhdmUoKTtcbiAgY29uc29sZS5sb2coJ1tBUEkgdGVsZWdyYW0tdXNlcl0g4pyFINCf0YDQvtGE0LjQu9GMINGA0LXRhNC10YDQtdGA0LAg0L7QsdC90L7QstC70LXQvTonLCB7XG4gICAgcmVmZXJlcklkOiByZWZlcmVyLnRlbGVncmFtSWQsXG4gICAgcmVmZXJyYWxzQ291bnQ6IHJlZmVyZXIucmVmZXJyYWxzLmxlbmd0aFxuICB9KTtcblxuICByZXR1cm4gbmV3UmVmZXJyYWw7XG59XG5cbi8qKlxuICog0J/QvtC70YPRh9Cw0LXRgiDQv9C+0LvRjNC30L7QstCw0YLQtdC70Y8g0YEg0LjQvdGE0L7RgNC80LDRhtC40LXQuSDQviDRgNC10YTQtdGA0LDQu9Cw0YVcbiAqL1xuYXN5bmMgZnVuY3Rpb24gZ2V0VXNlcldpdGhSZWZlcnJhbHModGVsZWdyYW1JZDogc3RyaW5nKSB7XG4gIGNvbnNvbGUubG9nKCdbQVBJIHRlbGVncmFtLXVzZXJdIPCflI0g0J/QvtC70YPRh9C10L3QuNC1INC00LDQvdC90YvRhSDQv9C+0LvRjNC30L7QstCw0YLQtdC70Y8g0YEg0YDQtdGE0LXRgNCw0LvQsNC80Lg6JywgdGVsZWdyYW1JZCk7XG4gIGNvbnN0IHVzZXIgPSBhd2FpdCBVc2VyLmZpbmRPbmUoeyB0ZWxlZ3JhbUlkIH0pO1xuICBpZiAoIXVzZXIpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoJ1VzZXIgbm90IGZvdW5kJyk7XG4gIH1cbiAgcmV0dXJuIHVzZXI7XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBQT1NUKHJlcTogTmV4dFJlcXVlc3QpOiBQcm9taXNlPE5leHRSZXNwb25zZT4ge1xuICBjb25zb2xlLmxvZygnW0FQSSB0ZWxlZ3JhbS11c2VyXSDwn5OlINCd0LDRh9Cw0LvQviDQvtCx0YDQsNCx0L7RgtC60Lgg0LfQsNC/0YDQvtGB0LAnKTtcbiAgXG4gIHRyeSB7XG4gICAgLy8gMS4g0JvQvtCz0LjRgNGD0LXQvCDQstGB0LUg0LfQsNCz0L7Qu9C+0LLQutC4INC30LDQv9GA0L7RgdCwXG4gICAgY29uc3QgaGVhZGVycyA9IHtcbiAgICAgIGNvbnRlbnRUeXBlOiByZXEuaGVhZGVycy5nZXQoJ2NvbnRlbnQtdHlwZScpLFxuICAgICAgdXNlckFnZW50OiByZXEuaGVhZGVycy5nZXQoJ3VzZXItYWdlbnQnKSxcbiAgICAgIHJlZmVyZXI6IHJlcS5oZWFkZXJzLmdldCgncmVmZXJlcicpXG4gICAgfTtcbiAgICBjb25zb2xlLmxvZygnW0FQSSB0ZWxlZ3JhbS11c2VyXSDwn5OLIEhlYWRlcnM6JywgaGVhZGVycyk7XG5cbiAgICAvLyAyLiDQn9C+0LvRg9GH0LDQtdC8INC4INC70L7Qs9C40YDRg9C10LwgVVJMINC/0LDRgNCw0LzQtdGC0YDRiyDQuNC3IHJlZmVyZXJcbiAgICBjb25zdCByZWZlcmVyVXJsID0gaGVhZGVycy5yZWZlcmVyID8gbmV3IFVSTChoZWFkZXJzLnJlZmVyZXIpIDogbnVsbDtcbiAgICBjb25zdCBzdGFydFBhcmFtRnJvbVJlZmVyZXIgPSByZWZlcmVyVXJsPy5zZWFyY2hQYXJhbXMuZ2V0KCd0Z1dlYkFwcFN0YXJ0UGFyYW0nKTtcblxuICAgIGNvbnNvbGUubG9nKCdbQVBJIHRlbGVncmFtLXVzZXJdIPCflI0g0J/QsNGA0LDQvNC10YLRgNGLINC40LcgcmVmZXJlcjonLCB7XG4gICAgICBzdGFydFBhcmFtRnJvbVJlZmVyZXIsXG4gICAgICBmdWxsUmVmZXJlclVybDogaGVhZGVycy5yZWZlcmVyXG4gICAgfSk7XG5cbiAgICBjb25zdCBib2R5ID0gYXdhaXQgcmVxLmpzb24oKTtcbiAgICBcbiAgICBjb25zb2xlLmxvZygnW0FQSSB0ZWxlZ3JhbS11c2VyXSDwn5OlINCi0LXQu9C+INC30LDQv9GA0L7RgdCwOicsIHtcbiAgICAgIGlkOiBib2R5LmlkLFxuICAgICAgc3RhcnRQYXJhbTogYm9keS5zdGFydFBhcmFtLFxuICAgICAgaGFzU3RhcnRQYXJhbTogISFib2R5LnN0YXJ0UGFyYW1cbiAgICB9KTtcblxuICAgIC8vINCY0YHQv9C+0LvRjNC30YPQtdC8IHN0YXJ0UGFyYW0g0LjQtyDRgtC10LvQsCDQt9Cw0L/RgNC+0YHQsCDQuNC70Lgg0LjQtyByZWZlcmVyXG4gICAgY29uc3Qgc3RhcnRQYXJhbSA9IGJvZHkuc3RhcnRQYXJhbSB8fCBzdGFydFBhcmFtRnJvbVJlZmVyZXI7XG4gICAgXG4gICAgLy8gMy4g0JvQvtCz0LjRgNGD0LXQvCDQv9C+0LvQvdC+0LUg0YLQtdC70L4g0LfQsNC/0YDQvtGB0LBcbiAgICBjb25zb2xlLmxvZygnW0FQSSB0ZWxlZ3JhbS11c2VyXSDwn5OmINCf0L7Qu9C90L7QtSDRgtC10LvQviDQt9Cw0L/RgNC+0YHQsDonLCBib2R5KTtcbiAgICBcbiAgICAvLyA0LiDQn9GA0L7QstC10YDRj9C10Lwg0LLRgdC1INCy0L7Qt9C80L7QttC90YvQtSDQuNGB0YLQvtGH0L3QuNC60Lggc3RhcnRQYXJhbVxuICAgIGNvbnN0IHN0YXJ0UGFyYW1Tb3VyY2VzID0ge1xuICAgICAgZnJvbUJvZHk6IGJvZHkuc3RhcnRQYXJhbSxcbiAgICAgIGZyb21TdGFydFBhcmFtOiBib2R5LnN0YXJ0X3BhcmFtLFxuICAgICAgZnJvbVdlYkFwcDogYm9keS50Z1dlYkFwcFN0YXJ0UGFyYW0sXG4gICAgICBmcm9tV2ViQXBwRGF0YTogYm9keS53ZWJBcHBEYXRhPy5zdGFydF9wYXJhbSxcbiAgICAgIGZyb21SZWZlcmVyOiBzdGFydFBhcmFtRnJvbVJlZmVyZXJcbiAgICB9O1xuICAgIFxuICAgIGNvbnNvbGUubG9nKCdbQVBJIHRlbGVncmFtLXVzZXJdIPCflI0g0JLRgdC1INC40YHRgtC+0YfQvdC40LrQuCBzdGFydFBhcmFtOicsIHN0YXJ0UGFyYW1Tb3VyY2VzKTtcbiAgICBcbiAgICAvLyA1LiDQntC/0YDQtdC00LXQu9GP0LXQvCDQuNGC0L7Qs9C+0LLRi9C5IHN0YXJ0UGFyYW1cbiAgICBjb25zdCBmaW5hbFN0YXJ0UGFyYW0gPSBcbiAgICAgIHN0YXJ0UGFyYW1Tb3VyY2VzLmZyb21Cb2R5IHx8IFxuICAgICAgc3RhcnRQYXJhbVNvdXJjZXMuZnJvbVN0YXJ0UGFyYW0gfHxcbiAgICAgIHN0YXJ0UGFyYW1Tb3VyY2VzLmZyb21XZWJBcHAgfHxcbiAgICAgIHN0YXJ0UGFyYW1Tb3VyY2VzLmZyb21XZWJBcHBEYXRhIHx8XG4gICAgICBzdGFydFBhcmFtU291cmNlcy5mcm9tUmVmZXJlcjtcbiAgICBcbiAgICBjb25zb2xlLmxvZygnW0FQSSB0ZWxlZ3JhbS11c2VyXSDinKgg0JjRgtC+0LPQvtCy0YvQuSBzdGFydFBhcmFtOicsIGZpbmFsU3RhcnRQYXJhbSk7XG5cbiAgICAvLyDQn9C+0LTQtNC10YDQttC40LLQsNC10Lwg0L7QsdCwINGE0L7RgNC80LDRgtCwINC00LDQvdC90YvRhVxuICAgIGNvbnN0IHRlbGVncmFtSWQgPSBib2R5LnRlbGVncmFtSWQgfHwgYm9keS5pZDtcbiAgICBjb25zdCB1c2VyRGF0YSA9IHtcbiAgICAgIGZpcnN0TmFtZTogYm9keS5maXJzdE5hbWUgfHwgYm9keS5maXJzdF9uYW1lLFxuICAgICAgbGFzdE5hbWU6IGJvZHkubGFzdE5hbWUgfHwgYm9keS5sYXN0X25hbWUsXG4gICAgICB1c2VybmFtZTogYm9keS51c2VybmFtZSxcbiAgICAgIGNoYXRJZDogYm9keS5jaGF0SWQgfHwgYm9keS50ZWxlZ3JhbV9jaGF0X2lkXG4gICAgfTtcblxuICAgIGlmICghdGVsZWdyYW1JZCkge1xuICAgICAgY29uc29sZS5sb2coJ1tBUEkgdGVsZWdyYW0tdXNlcl0g4p2MINCe0YLRgdGD0YLRgdGC0LLRg9C10YIgdGVsZWdyYW1JZCcpO1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgXG4gICAgICAgIHN1Y2Nlc3M6IGZhbHNlLCBcbiAgICAgICAgZXJyb3I6ICdUZWxlZ3JhbSBJRCBpcyByZXF1aXJlZCcgXG4gICAgICB9LCB7IHN0YXR1czogNDAwIH0pO1xuICAgIH1cblxuICAgIGF3YWl0IGNvbm5lY3RUb0RhdGFiYXNlKCk7XG4gICAgXG4gICAgLy8gMS4g0KHQvtC30LTQsNC10Lwv0L7QsdC90L7QstC70Y/QtdC8INC/0L7Qu9GM0LfQvtCy0LDRgtC10LvRj1xuICAgIGNvbnN0IHVzZXIgPSBhd2FpdCBjcmVhdGVUZWxlZ3JhbVVzZXIoU3RyaW5nKHRlbGVncmFtSWQpLCB1c2VyRGF0YSk7XG4gICAgXG4gICAgLy8gMi4g0JXRgdC70Lgg0LXRgdGC0Ywgc3RhcnRQYXJhbSwg0YDQtdCz0LjRgdGC0YDQuNGA0YPQtdC8INGA0LXRhNC10YDQsNC70LBcbiAgICBsZXQgcmVmZXJyYWwgPSBudWxsO1xuICAgIGlmIChmaW5hbFN0YXJ0UGFyYW0pIHtcbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdbQVBJIHRlbGVncmFtLXVzZXJdIPCfjq8g0J/QvtC/0YvRgtC60LAg0YDQtdCz0LjRgdGC0YDQsNGG0LjQuCDRgNC10YTQtdGA0LDQu9CwOicsIHtcbiAgICAgICAgdGVsZWdyYW1JZCxcbiAgICAgICAgICBzdGFydFBhcmFtOiBmaW5hbFN0YXJ0UGFyYW0sXG4gICAgICAgICAgdXNlckRhdGFcbiAgICAgICAgfSk7XG4gICAgICAgIHJlZmVycmFsID0gYXdhaXQgcmVnaXN0ZXJSZWZlcnJhbChTdHJpbmcodGVsZWdyYW1JZCksIGZpbmFsU3RhcnRQYXJhbSk7XG4gICAgICB9IGNhdGNoIChyZWZFcnJvcikge1xuICAgICAgICBjb25zb2xlLmVycm9yKCdbQVBJIHRlbGVncmFtLXVzZXJdIOKdjCDQntGI0LjQsdC60LAg0L/RgNC4INGA0LXQs9C40YHRgtGA0LDRhtC40Lgg0YDQtdGE0LXRgNCw0LvQsDonLCByZWZFcnJvcik7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnNvbGUubG9nKCdbQVBJIHRlbGVncmFtLXVzZXJdIOKEue+4jyBzdGFydFBhcmFtINC+0YLRgdGD0YLRgdGC0LLRg9C10YIsINC/0YDQvtC/0YPRgdC60LDQtdC8INGA0LXQs9C40YHRgtGA0LDRhtC40Y4g0YDQtdGE0LXRgNCw0LvQsCcpO1xuICAgIH1cblxuICAgIC8vIDMuINCf0L7Qu9GD0YfQsNC10Lwg0L7QsdC90L7QstC70LXQvdC90YvQtSDQtNCw0L3QvdGL0LUg0L/QvtC70YzQt9C+0LLQsNGC0LXQu9GPXG4gICAgY29uc3QgdXBkYXRlZFVzZXIgPSBhd2FpdCBnZXRVc2VyV2l0aFJlZmVycmFscyhTdHJpbmcodGVsZWdyYW1JZCkpO1xuXG4gICAgY29uc29sZS5sb2coJ1tBUEkgdGVsZWdyYW0tdXNlcl0g4pyFINCX0LDQv9GA0L7RgSDQvtCx0YDQsNCx0L7RgtCw0L0g0YPRgdC/0LXRiNC90L46Jywge1xuICAgICAgdXNlcklkOiB0ZWxlZ3JhbUlkLFxuICAgICAgaGFzU3RhcnRQYXJhbTogISFmaW5hbFN0YXJ0UGFyYW0sXG4gICAgICBoYXNSZWZlcnJhbDogISFyZWZlcnJhbCxcbiAgICAgIHJlZmVycmFsU3RhdHVzOiByZWZlcnJhbCA/IHtcbiAgICAgICAgaXNWYWxpZDogcmVmZXJyYWwuaXNWYWxpZCxcbiAgICAgICAgaGFzUGxheWVkUm9vbUE6IHJlZmVycmFsLmhhc1BsYXllZFJvb21BLFxuICAgICAgICBoYXNQbGF5ZWRSb29tQjogcmVmZXJyYWwuaGFzUGxheWVkUm9vbUJcbiAgICAgIH0gOiBudWxsXG4gICAgfSk7XG5cbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oe1xuICAgICAgc3VjY2VzczogdHJ1ZSwgXG4gICAgICBkYXRhOiB1cGRhdGVkVXNlcixcbiAgICAgIHJlZmVycmFsOiByZWZlcnJhbFxuICAgIH0pO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ1tBUEkgdGVsZWdyYW0tdXNlcl0g4p2MINCe0YjQuNCx0LrQsDonLCBlcnJvcik7XG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgXG4gICAgICBzdWNjZXNzOiBmYWxzZSwgXG4gICAgICBlcnJvcjogZXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGVycm9yLm1lc3NhZ2UgOiAnRmFpbGVkIHRvIHByb2Nlc3MgdXNlcidcbiAgICB9LCB7IHN0YXR1czogNTAwIH0pO1xuICB9XG59ICJdLCJuYW1lcyI6WyJOZXh0UmVzcG9uc2UiLCJjb25uZWN0VG9EYXRhYmFzZSIsIlVzZXIiLCJSZWZlcnJhbCIsImR5bmFtaWMiLCJjcmVhdGVUZWxlZ3JhbVVzZXIiLCJ0ZWxlZ3JhbUlkIiwidXNlckRhdGEiLCJjb25zb2xlIiwibG9nIiwidXNlciIsImZpbmRPbmUiLCJmaXJzdE5hbWUiLCJsYXN0TmFtZSIsInVzZXJuYW1lIiwicGhvdG9VcmwiLCJjaGF0SWQiLCJzYXZlIiwibmV3VXNlciIsImNyZWF0ZSIsInJlZmVycmFsQ29kZSIsInNsaWNlIiwiTWF0aCIsInJhbmRvbSIsInRvU3RyaW5nIiwic3Vic3RyaW5nIiwidGlja2V0cyIsInRvbm90Q2hhbmNlVGlja2V0cyIsImJhbGFuY2UiLCJ0b25CYWxhbmNlIiwibGFzdEFjdGl2ZSIsIkRhdGUiLCJpZCIsInJlZ2lzdGVyUmVmZXJyYWwiLCJzdGFydFBhcmFtIiwicmVmZXJlciIsIkVycm9yIiwiY29kZSIsImV4aXN0aW5nUmVmZXJyYWwiLCJyZWZlcmVySWQiLCJyZWZlcnJhbElkIiwiaXNWYWxpZCIsInJlZmVyYWwiLCJuZXdSZWZlcnJhbCIsImhhc1BsYXllZFJvb21BIiwiaGFzUGxheWVkUm9vbUIiLCJjcmVhdGVkQXQiLCJfaWQiLCJyZWZlcnJhbHMiLCJwdXNoIiwidXNlcklkIiwicm9vbUFQbGF5ZWQiLCJyb29tQlBsYXllZCIsInJlZmVycmFsc0NvdW50IiwibGVuZ3RoIiwiZ2V0VXNlcldpdGhSZWZlcnJhbHMiLCJQT1NUIiwicmVxIiwiaGVhZGVycyIsImNvbnRlbnRUeXBlIiwiZ2V0IiwidXNlckFnZW50IiwicmVmZXJlclVybCIsIlVSTCIsInN0YXJ0UGFyYW1Gcm9tUmVmZXJlciIsInNlYXJjaFBhcmFtcyIsImZ1bGxSZWZlcmVyVXJsIiwiYm9keSIsImpzb24iLCJoYXNTdGFydFBhcmFtIiwic3RhcnRQYXJhbVNvdXJjZXMiLCJmcm9tQm9keSIsImZyb21TdGFydFBhcmFtIiwic3RhcnRfcGFyYW0iLCJmcm9tV2ViQXBwIiwidGdXZWJBcHBTdGFydFBhcmFtIiwiZnJvbVdlYkFwcERhdGEiLCJ3ZWJBcHBEYXRhIiwiZnJvbVJlZmVyZXIiLCJmaW5hbFN0YXJ0UGFyYW0iLCJmaXJzdF9uYW1lIiwibGFzdF9uYW1lIiwidGVsZWdyYW1fY2hhdF9pZCIsInN1Y2Nlc3MiLCJlcnJvciIsInN0YXR1cyIsIlN0cmluZyIsInJlZmVycmFsIiwicmVmRXJyb3IiLCJ1cGRhdGVkVXNlciIsImhhc1JlZmVycmFsIiwicmVmZXJyYWxTdGF0dXMiLCJkYXRhIiwibWVzc2FnZSJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/app/api/telegram-user/route.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/config.ts":
/*!***************************!*\
  !*** ./src/lib/config.ts ***!
  \***************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   APP_CONFIG: () => (/* binding */ APP_CONFIG),\n/* harmony export */   CONFIG: () => (/* binding */ CONFIG),\n/* harmony export */   IS_DEV_MODE: () => (/* binding */ IS_DEV_MODE),\n/* harmony export */   MATCH_TIMEOUT: () => (/* binding */ MATCH_TIMEOUT),\n/* harmony export */   MAX_PLAYERS: () => (/* binding */ MAX_PLAYERS),\n/* harmony export */   MIN_PLAYERS: () => (/* binding */ MIN_PLAYERS),\n/* harmony export */   QUEUE_TIMEOUT: () => (/* binding */ QUEUE_TIMEOUT),\n/* harmony export */   SOCKET_CONFIG: () => (/* binding */ SOCKET_CONFIG),\n/* harmony export */   SOCKET_URL: () => (/* binding */ SOCKET_URL),\n/* harmony export */   TON_CONFIG: () => (/* binding */ TON_CONFIG),\n/* harmony export */   X10_CONFIG: () => (/* binding */ X10_CONFIG),\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n// Объявление типов для переменных окружения\n/**\n * Конфигурация приложения\n */ const CONFIG = {\n    // Адрес кошелька для приема платежей\n    WALLET_ADDRESS: process.env.NEXT_PUBLIC_WALLET_ADDRESS,\n    // Адрес кошелька разработчика для отправки TON\n    DEVELOPER_ADDRESS: \"UQBDpsvrVFPp5P5gLXJKGNl42BVq5zzqfJYJXQuufQwhxBf7\",\n    // Настройки сети TON\n    NETWORK: process.env.NEXT_PUBLIC_NETWORK || \"mainnet\",\n    // API ключ TON\n    TON_API_KEY: \"cacf6f5bd0603089739e73cb7619d972c34743f0e718b59d4cea17c4dfb9db95\",\n    // URL-адреса для приложения\n    APP_URL: \"https://oldfrager.xyz\",\n    API_URL: \"https://oldfrager.xyz/api\",\n    // Настройки MongoDB\n    MONGODB_URI: process.env.MONGODB_URI,\n    // Цена за 1 билет в TON\n    TICKET_PRICE: Number(process.env.NEXT_PUBLIC_TICKET_PRICE) || 0.000000001,\n    // Комиссия платформы в процентах\n    PLATFORM_FEE: Number(process.env.NEXT_PUBLIC_PLATFORM_FEE) || 5,\n    // Параметры для хранения данных в localStorage\n    STORAGE_KEYS: {\n        AUTH: \"tonot_auth\",\n        USER: \"tonot_user\",\n        THEME: \"tonot_theme\",\n        LANG: \"tonot_lang\",\n        TELEGRAM_USER: \"telegram_user\",\n        ACCESS_TOKEN: \"access_token\",\n        TICKETS: \"tickets\",\n        TONOT_CHANCE_TICKETS: \"tonotChanceTickets\",\n        X10_GAME_STATE: \"x10_game_state\"\n    },\n    // Максимальное количество попыток подключения к базе данных\n    MAX_DB_CONNECT_RETRIES: 5,\n    // Задержка между попытками подключения к базе данных (в миллисекундах)\n    DB_RETRY_DELAY: 2000,\n    // API эндпоинты\n    API_ENDPOINTS: {\n        // Основные эндпоинты\n        USER_DATA: \"/api/user-data\",\n        TELEGRAM_USER: \"/api/telegram-user\",\n        TICKETS: \"/api/tickets/purchase\",\n        // X2 эндпоинты (классическая игра)\n        X2: {\n            GAME: \"/api/match/game\",\n            CREATE: \"/api/match/create\",\n            CANCEL: \"/api/match/cancel\",\n            COMPLETE: \"/api/match/complete\" // Завершение матча\n        },\n        // X10 эндпоинты (мультиплеер)\n        X10: {\n            GAME: \"/api/match/x10/game\",\n            CREATE: \"/api/match/x10/create\",\n            CANCEL: \"/api/match/x10/cancel\",\n            COMPLETE: \"/api/match/x10/complete\" // Завершение матча\n        }\n    }\n};\n/**\n * URL для WebSocket соединения\n */ const SOCKET_URL = process.env.NEXT_PUBLIC_SOCKET_URL;\n/**\n * Конфигурация для Socket.IO сервера\n */ const SOCKET_CONFIG = {\n    // CORS настройки\n    cors: {\n        origin: process.env.SOCKET_CORS_ORIGIN || \"*\",\n        methods: [\n            \"GET\",\n            \"POST\"\n        ],\n        credentials: true\n    },\n    // Настройки пинга и таймаутов\n    pingTimeout: 30000,\n    pingInterval: 15000,\n    connectTimeout: 10000,\n    // Настройки переподключения\n    reconnection: true,\n    reconnectionAttempts: 3,\n    reconnectionDelay: 2000,\n    // Настройки для игры\n    waitingTimeout: 120000,\n    matchTimeout: 300000,\n    countdownTime: 5 // время обратного отсчета в секундах\n};\n/**\n * Конфигурация для режима X10\n */ const X10_CONFIG = {\n    // Основные настройки\n    MIN_PLAYERS: 10,\n    MAX_PLAYERS: 10,\n    WINNERS_COUNT: 3,\n    // Для обратной совместимости\n    PLAYERS: {\n        MIN: 10,\n        MAX: 10\n    },\n    // Настройки призов (в процентах от общего пула)\n    PRIZE_DISTRIBUTION: {\n        FIRST_PLACE: 50,\n        SECOND_PLACE: 30,\n        THIRD_PLACE: 20 // 20% пула для третьего места\n    },\n    // Таймауты\n    QUEUE_TIMEOUT: 600000,\n    MATCH_TIMEOUT: 300000,\n    COUNTDOWN_TIME: 10,\n    // Настройки переподключения\n    MAX_RECONNECT_ATTEMPTS: 3,\n    RECONNECT_DELAY: 2000,\n    // Настройки билетов\n    TICKETS: {\n        // Активные билеты для игры (сгорают при использовании)\n        GAME: {\n            COST: 1,\n            FIELD_NAME: \"chance\" // Название поля в API и базе данных\n        },\n        // Пассивные билеты TONOT CHANCE (начисляются за проигрыш)\n        TONOT_CHANCE: {\n            REWARD: 1,\n            FIELD_NAME: \"tonotChanceTickets\" // Название поля в API и базе данных\n        }\n    },\n    // Настройки матча\n    MATCH: {\n        MIN_PLAYERS: 10,\n        MAX_PLAYERS: 10,\n        TIMEOUT: 300000,\n        QUEUE_TIMEOUT: 600000 // 10 минут\n    },\n    // Настройки призов\n    PRIZES: {\n        FIRST: 450,\n        SECOND: 270,\n        THIRD: 180,\n        CONSOLATION_TICKET: 1 // Утешительный билет для проигравших\n    },\n    // Тайминги анимаций\n    GAME_TIMINGS: {\n        PREPARING: 5000,\n        MERGING: 7500,\n        WHEEL_APPEAR: 4000,\n        WHEEL_SPIN: 7000,\n        WHEEL_STOP: 2000,\n        RESULT: 1000 // 1 секунда\n    }\n};\n// Экспортируем также отдельные константы для обратной совместимости\nconst MAX_PLAYERS = X10_CONFIG.MAX_PLAYERS;\nconst MIN_PLAYERS = X10_CONFIG.MIN_PLAYERS;\nconst MATCH_TIMEOUT = X10_CONFIG.MATCH_TIMEOUT;\nconst QUEUE_TIMEOUT = X10_CONFIG.QUEUE_TIMEOUT;\n/**\n * Конфигурация для работы с TON\n */ const TON_CONFIG = {\n    // Адрес TON кошелька приложения\n    WALLET_ADDRESS: process.env.NEXT_PUBLIC_WALLET_ADDRESS || CONFIG.WALLET_ADDRESS,\n    // Адрес кошелька разработчика\n    DEVELOPER_ADDRESS: \"UQBDpsvrVFPp5P5gLXJKGNl42BVq5zzqfJYJXQuufQwhxBf7\" || 0,\n    // API ключ для TON\n    API_KEY: \"cacf6f5bd0603089739e73cb7619d972c34743f0e718b59d4cea17c4dfb9db95\" || 0\n};\n// Другие настройки приложения\nconst APP_CONFIG = {\n    buildTimeDBConnection: \"true\" !== \"true\"\n};\n// Добавляем конфигурацию для режима симуляции\nconst IS_DEV_MODE = \"development\" === \"development\";\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (CONFIG);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUNsQkcsT0FBTztRQUNMbkIsYUFBYTtRQUNiQyxhQUFhO1FBQ2JtQixTQUFTO1FBQ1RWLGVBQWUsT0FBTyxXQUFXO0lBQ25DO0lBRUEsbUJBQW1CO0lBQ25CVyxRQUFRO1FBQ05DLE9BQU87UUFDUEMsUUFBUTtRQUNSQyxPQUFPO1FBQ1BDLG9CQUFvQixFQUFHLHFDQUFxQztJQUM5RDtJQUVBLG9CQUFvQjtJQUNwQkMsY0FBYztRQUNaQyxXQUFXO1FBQ1hDLFNBQVM7UUFDVEMsY0FBYztRQUNkQyxZQUFZO1FBQ1pDLFlBQVk7UUFDWkMsUUFBUSxLQUFZLFlBQVk7SUFDbEM7QUFDRixFQUFXO0FBRVgsb0VBQW9FO0FBQzdELE1BQU0vQixjQUFjRixXQUFXRSxXQUFXLENBQUM7QUFDM0MsTUFBTUQsY0FBY0QsV0FBV0MsV0FBVyxDQUFDO0FBQzNDLE1BQU1XLGdCQUFnQlosV0FBV1ksYUFBYSxDQUFDO0FBQy9DLE1BQU1ELGdCQUFnQlgsV0FBV1csYUFBYSxDQUFDO0FBRXREOztDQUVDLEdBQ00sTUFBTXVCLGFBQWE7SUFDeEIsZ0NBQWdDO0lBQ2hDM0YsZ0JBQWdCQyxRQUFRQyxHQUFHLENBQUNDLDBCQUEwQixJQUFJSixPQUFPQyxjQUFjO0lBRS9FLDhCQUE4QjtJQUM5QkksbUJBQW1CSCxrREFBeUMsSUFBSUYsQ0FBd0I7SUFFeEYsbUJBQW1CO0lBQ25CNkYsU0FBUzNGLGtFQUFtQyxJQUFJRixDQUFrQjtBQUNwRSxFQUFFO0FBRUYsOEJBQThCO0FBQ3ZCLE1BQU04RixhQUFhO0lBQ3hCQyx1QkFBdUI3RixNQUEyQyxLQUFLO0FBQ3pFLEVBQUU7QUFFRiw4Q0FBOEM7QUFDdkMsTUFBTStGLGNBQWMvRixrQkFBeUIsY0FBYztBQUVsRSxpRUFBZUYsTUFBTUEsRUFBQyIsInNvdXJjZXMiOlsid2VicGFjazovL25leHRqcy10ZW1wbGF0ZS8uL3NyYy9saWIvY29uZmlnLnRzP2EzZWYiXSwic291cmNlc0NvbnRlbnQiOlsiLy8g0J7QsdGK0Y/QstC70LXQvdC40LUg0YLQuNC/0L7QsiDQtNC70Y8g0L/QtdGA0LXQvNC10L3QvdGL0YUg0L7QutGA0YPQttC10L3QuNGPXG5kZWNsYXJlIGdsb2JhbCB7XG4gIG5hbWVzcGFjZSBOb2RlSlMge1xuICAgIGludGVyZmFjZSBQcm9jZXNzRW52IHtcbiAgICAgIE5FWFRfUFVCTElDX1dBTExFVF9BRERSRVNTOiBzdHJpbmc7XG4gICAgICBORVhUX1BVQkxJQ19ERVZFTE9QRVJfQUREUkVTUzogc3RyaW5nO1xuICAgICAgTkVYVF9QVUJMSUNfVE9OX0FQSV9LRVk6IHN0cmluZztcbiAgICAgIE5FWFRfUFVCTElDX0FQUF9VUkw6IHN0cmluZztcbiAgICAgIE5FWFRfUFVCTElDX0FQSV9VUkw6IHN0cmluZztcbiAgICAgIE1PTkdPREJfVVJJOiBzdHJpbmc7XG4gICAgICBORVhUX1BVQkxJQ19TT0NLRVRfVVJMOiBzdHJpbmc7XG4gICAgICBTT0NLRVRfQ09SU19PUklHSU46IHN0cmluZztcbiAgICAgIE5FWFRfUFVCTElDX05FVFdPUks6IHN0cmluZztcbiAgICAgIE5FWFRfUFVCTElDX1RJQ0tFVF9QUklDRTogc3RyaW5nO1xuICAgICAgTkVYVF9QVUJMSUNfUExBVEZPUk1fRkVFOiBzdHJpbmc7XG4gICAgfVxuICB9XG59XG5cbi8qKlxuICog0JrQvtC90YTQuNCz0YPRgNCw0YbQuNGPINC/0YDQuNC70L7QttC10L3QuNGPXG4gKi9cbmV4cG9ydCBjb25zdCBDT05GSUcgPSB7XG4gIC8vINCQ0LTRgNC10YEg0LrQvtGI0LXQu9GM0LrQsCDQtNC70Y8g0L/RgNC40LXQvNCwINC/0LvQsNGC0LXQttC10LlcbiAgV0FMTEVUX0FERFJFU1M6IHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1dBTExFVF9BRERSRVNTLFxuICBcbiAgLy8g0JDQtNGA0LXRgSDQutC+0YjQtdC70YzQutCwINGA0LDQt9GA0LDQsdC+0YLRh9C40LrQsCDQtNC70Y8g0L7RgtC/0YDQsNCy0LrQuCBUT05cbiAgREVWRUxPUEVSX0FERFJFU1M6IHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX0RFVkVMT1BFUl9BRERSRVNTLFxuICBcbiAgLy8g0J3QsNGB0YLRgNC+0LnQutC4INGB0LXRgtC4IFRPTlxuICBORVRXT1JLOiBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19ORVRXT1JLIHx8ICdtYWlubmV0JyxcbiAgXG4gIC8vIEFQSSDQutC70Y7RhyBUT05cbiAgVE9OX0FQSV9LRVk6IHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1RPTl9BUElfS0VZLFxuICBcbiAgLy8gVVJMLdCw0LTRgNC10YHQsCDQtNC70Y8g0L/RgNC40LvQvtC20LXQvdC40Y9cbiAgQVBQX1VSTDogcHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfQVBQX1VSTCxcbiAgQVBJX1VSTDogcHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfQVBJX1VSTCxcbiAgXG4gIC8vINCd0LDRgdGC0YDQvtC50LrQuCBNb25nb0RCXG4gIE1PTkdPREJfVVJJOiBwcm9jZXNzLmVudi5NT05HT0RCX1VSSSxcbiAgXG4gIC8vINCm0LXQvdCwINC30LAgMSDQsdC40LvQtdGCINCyIFRPTlxuICBUSUNLRVRfUFJJQ0U6IE51bWJlcihwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19USUNLRVRfUFJJQ0UpIHx8IDAuMDAwMDAwMDAxLFxuICBcbiAgLy8g0JrQvtC80LjRgdGB0LjRjyDQv9C70LDRgtGE0L7RgNC80Ysg0LIg0L/RgNC+0YbQtdC90YLQsNGFXG4gIFBMQVRGT1JNX0ZFRTogTnVtYmVyKHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1BMQVRGT1JNX0ZFRSkgfHwgNSxcbiAgXG4gIC8vINCf0LDRgNCw0LzQtdGC0YDRiyDQtNC70Y8g0YXRgNCw0L3QtdC90LjRjyDQtNCw0L3QvdGL0YUg0LIgbG9jYWxTdG9yYWdlXG4gIFNUT1JBR0VfS0VZUzoge1xuICAgIEFVVEg6ICd0b25vdF9hdXRoJyxcbiAgICBVU0VSOiAndG9ub3RfdXNlcicsXG4gICAgVEhFTUU6ICd0b25vdF90aGVtZScsXG4gICAgTEFORzogJ3Rvbm90X2xhbmcnLFxuICAgIFRFTEVHUkFNX1VTRVI6ICd0ZWxlZ3JhbV91c2VyJyxcbiAgICBBQ0NFU1NfVE9LRU46ICdhY2Nlc3NfdG9rZW4nLFxuICAgIFRJQ0tFVFM6ICd0aWNrZXRzJywgICAgICAgICAgICAgICAgICAgIC8vINCQ0LrRgtC40LLQvdGL0LUg0LHQuNC70LXRgtGLXG4gICAgVE9OT1RfQ0hBTkNFX1RJQ0tFVFM6ICd0b25vdENoYW5jZVRpY2tldHMnLCAvLyDQn9Cw0YHRgdC40LLQvdGL0LUg0LHQuNC70LXRgtGLXG4gICAgWDEwX0dBTUVfU1RBVEU6ICd4MTBfZ2FtZV9zdGF0ZSdcbiAgfSxcbiAgXG4gIC8vINCc0LDQutGB0LjQvNCw0LvRjNC90L7QtSDQutC+0LvQuNGH0LXRgdGC0LLQviDQv9C+0L/Ri9GC0L7QuiDQv9C+0LTQutC70Y7Rh9C10L3QuNGPINC6INCx0LDQt9C1INC00LDQvdC90YvRhVxuICBNQVhfREJfQ09OTkVDVF9SRVRSSUVTOiA1LFxuICBcbiAgLy8g0JfQsNC00LXRgNC20LrQsCDQvNC10LbQtNGDINC/0L7Qv9GL0YLQutCw0LzQuCDQv9C+0LTQutC70Y7Rh9C10L3QuNGPINC6INCx0LDQt9C1INC00LDQvdC90YvRhSAo0LIg0LzQuNC70LvQuNGB0LXQutGD0L3QtNCw0YUpXG4gIERCX1JFVFJZX0RFTEFZOiAyMDAwLFxuXG4gIC8vIEFQSSDRjdC90LTQv9C+0LjQvdGC0YtcbiAgQVBJX0VORFBPSU5UUzoge1xuICAgIC8vINCe0YHQvdC+0LLQvdGL0LUg0Y3QvdC00L/QvtC40L3RgtGLXG4gICAgVVNFUl9EQVRBOiAnL2FwaS91c2VyLWRhdGEnLFxuICAgIFRFTEVHUkFNX1VTRVI6ICcvYXBpL3RlbGVncmFtLXVzZXInLFxuICAgIFRJQ0tFVFM6ICcvYXBpL3RpY2tldHMvcHVyY2hhc2UnLFxuICAgIFxuICAgIC8vIFgyINGN0L3QtNC/0L7QuNC90YLRiyAo0LrQu9Cw0YHRgdC40YfQtdGB0LrQsNGPINC40LPRgNCwKVxuICAgIFgyOiB7XG4gICAgICBHQU1FOiAnL2FwaS9tYXRjaC9nYW1lJywgICAgICAgICAvLyDQn9C+0LvRg9GH0LXQvdC40LUg0LjQvdGE0L7RgNC80LDRhtC40Lgg0L7QsSDQsNC60YLQuNCy0L3QvtC5INC40LPRgNC1XG4gICAgICBDUkVBVEU6ICcvYXBpL21hdGNoL2NyZWF0ZScsICAgICAgLy8g0KHQvtC30LTQsNC90LjQtSDQvNCw0YLRh9CwXG4gICAgICBDQU5DRUw6ICcvYXBpL21hdGNoL2NhbmNlbCcsICAgICAgLy8g0J7RgtC80LXQvdCwINGD0YfQsNGB0YLQuNGPXG4gICAgICBDT01QTEVURTogJy9hcGkvbWF0Y2gvY29tcGxldGUnICAgLy8g0JfQsNCy0LXRgNGI0LXQvdC40LUg0LzQsNGC0YfQsFxuICAgIH0sXG4gICAgXG4gICAgLy8gWDEwINGN0L3QtNC/0L7QuNC90YLRiyAo0LzRg9C70YzRgtC40L/Qu9C10LXRgClcbiAgICBYMTA6IHtcbiAgICAgIEdBTUU6ICcvYXBpL21hdGNoL3gxMC9nYW1lJywgICAgICAvLyDQn9C+0LvRg9GH0LXQvdC40LUg0LjQvdGE0L7RgNC80LDRhtC40Lgg0L7QsSDQsNC60YLQuNCy0L3QvtC5INC40LPRgNC1XG4gICAgICBDUkVBVEU6ICcvYXBpL21hdGNoL3gxMC9jcmVhdGUnLCAgIC8vINCh0L7Qt9C00LDQvdC40LUg0L3QvtCy0L7Qs9C+INC80LDRgtGH0LBcbiAgICAgIENBTkNFTDogJy9hcGkvbWF0Y2gveDEwL2NhbmNlbCcsICAgLy8g0J7RgtC80LXQvdCwINGD0YfQsNGB0YLQuNGPXG4gICAgICBDT01QTEVURTogJy9hcGkvbWF0Y2gveDEwL2NvbXBsZXRlJyAvLyDQl9Cw0LLQtdGA0YjQtdC90LjQtSDQvNCw0YLRh9CwXG4gICAgfVxuICB9XG59O1xuXG4vKipcbiAqIFVSTCDQtNC70Y8gV2ViU29ja2V0INGB0L7QtdC00LjQvdC10L3QuNGPXG4gKi9cbmV4cG9ydCBjb25zdCBTT0NLRVRfVVJMID0gcHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfU09DS0VUX1VSTDtcblxuLyoqXG4gKiDQmtC+0L3RhNC40LPRg9GA0LDRhtC40Y8g0LTQu9GPIFNvY2tldC5JTyDRgdC10YDQstC10YDQsFxuICovXG5leHBvcnQgY29uc3QgU09DS0VUX0NPTkZJRyA9IHtcbiAgLy8gQ09SUyDQvdCw0YHRgtGA0L7QudC60LhcbiAgY29yczoge1xuICAgIG9yaWdpbjogcHJvY2Vzcy5lbnYuU09DS0VUX0NPUlNfT1JJR0lOIHx8ICcqJyxcbiAgICBtZXRob2RzOiBbJ0dFVCcsICdQT1NUJ10sXG4gICAgY3JlZGVudGlhbHM6IHRydWVcbiAgfSxcbiAgXG4gIC8vINCd0LDRgdGC0YDQvtC50LrQuCDQv9C40L3Qs9CwINC4INGC0LDQudC80LDRg9GC0L7QslxuICBwaW5nVGltZW91dDogMzAwMDAsXG4gIHBpbmdJbnRlcnZhbDogMTUwMDAsXG4gIGNvbm5lY3RUaW1lb3V0OiAxMDAwMCxcbiAgXG4gIC8vINCd0LDRgdGC0YDQvtC50LrQuCDQv9C10YDQtdC/0L7QtNC60LvRjtGH0LXQvdC40Y9cbiAgcmVjb25uZWN0aW9uOiB0cnVlLFxuICByZWNvbm5lY3Rpb25BdHRlbXB0czogMyxcbiAgcmVjb25uZWN0aW9uRGVsYXk6IDIwMDAsXG4gIFxuICAvLyDQndCw0YHRgtGA0L7QudC60Lgg0LTQu9GPINC40LPRgNGLXG4gIHdhaXRpbmdUaW1lb3V0OiAxMjAwMDAsIC8vIDIg0LzQuNC90YPRgtGLINCyINC80LjQu9C70LjRgdC10LrRg9C90LTQsNGFXG4gIG1hdGNoVGltZW91dDogMzAwMDAwLCAgIC8vIDUg0LzQuNC90YPRgiDQsiDQvNC40LvQu9C40YHQtdC60YPQvdC00LDRhVxuICBjb3VudGRvd25UaW1lOiA1ICAgICAgICAvLyDQstGA0LXQvNGPINC+0LHRgNCw0YLQvdC+0LPQviDQvtGC0YHRh9C10YLQsCDQsiDRgdC10LrRg9C90LTQsNGFXG59O1xuXG4vKipcbiAqINCa0L7QvdGE0LjQs9GD0YDQsNGG0LjRjyDQtNC70Y8g0YDQtdC20LjQvNCwIFgxMFxuICovXG5leHBvcnQgY29uc3QgWDEwX0NPTkZJRyA9IHtcbiAgLy8g0J7RgdC90L7QstC90YvQtSDQvdCw0YHRgtGA0L7QudC60LhcbiAgTUlOX1BMQVlFUlM6IDEwLCAvLyDQnNC40L3QuNC80LDQu9GM0L3QvtC1INC60L7Qu9C40YfQtdGB0YLQstC+INC40LPRgNC+0LrQvtCyINC00LvRjyDRgdGC0LDRgNGC0LBcbiAgTUFYX1BMQVlFUlM6IDEwLCAvLyDQnNCw0LrRgdC40LzQsNC70YzQvdC+0LUg0LrQvtC70LjRh9C10YHRgtCy0L4g0LjQs9GA0L7QutC+0LIg0LIg0LzQsNGC0YfQtVxuICBXSU5ORVJTX0NPVU5UOiAzLCAvLyDQmtC+0LvQuNGH0LXRgdGC0LLQviDQv9C+0LHQtdC00LjRgtC10LvQtdC5XG4gIFxuICAvLyDQlNC70Y8g0L7QsdGA0LDRgtC90L7QuSDRgdC+0LLQvNC10YHRgtC40LzQvtGB0YLQuFxuICBQTEFZRVJTOiB7XG4gICAgTUlOOiAxMCxcbiAgICBNQVg6IDEwXG4gIH0sXG4gIFxuICAvLyDQndCw0YHRgtGA0L7QudC60Lgg0L/RgNC40LfQvtCyICjQsiDQv9GA0L7RhtC10L3RgtCw0YUg0L7RgiDQvtCx0YnQtdCz0L4g0L/Rg9C70LApXG4gIFBSSVpFX0RJU1RSSUJVVElPTjoge1xuICAgIEZJUlNUX1BMQUNFOiA1MCwgIC8vIDUwJSDQv9GD0LvQsCDQtNC70Y8g0L/QtdGA0LLQvtCz0L4g0LzQtdGB0YLQsFxuICAgIFNFQ09ORF9QTEFDRTogMzAsIC8vIDMwJSDQv9GD0LvQsCDQtNC70Y8g0LLRgtC+0YDQvtCz0L4g0LzQtdGB0YLQsFxuICAgIFRISVJEX1BMQUNFOiAyMCAgIC8vIDIwJSDQv9GD0LvQsCDQtNC70Y8g0YLRgNC10YLRjNC10LPQviDQvNC10YHRgtCwXG4gIH0sXG4gIFxuICAvLyDQotCw0LnQvNCw0YPRgtGLXG4gIFFVRVVFX1RJTUVPVVQ6IDYwMDAwMCwgICAgIC8vIDEwINC80LjQvdGD0YIg0L3QsCDQvtC20LjQtNCw0L3QuNC1INCyINC+0YfQtdGA0LXQtNC4XG4gIE1BVENIX1RJTUVPVVQ6IDMwMDAwMCwgICAgIC8vIDUg0LzQuNC90YPRgiDQvdCwINC40LPRgNGDXG4gIENPVU5URE9XTl9USU1FOiAxMCwgICAgICAgIC8vIDEwINGB0LXQutGD0L3QtCDQvtCx0YDQsNGC0L3Ri9C5INC+0YLRgdGH0LXRglxuICBcbiAgLy8g0J3QsNGB0YLRgNC+0LnQutC4INC/0LXRgNC10L/QvtC00LrQu9GO0YfQtdC90LjRj1xuICBNQVhfUkVDT05ORUNUX0FUVEVNUFRTOiAzLCAvLyDQnNCw0LrRgdC40LzQsNC70YzQvdC+0LUg0LrQvtC70LjRh9C10YHRgtCy0L4g0L/QvtC/0YvRgtC+0Log0L/QtdGA0LXQv9C+0LTQutC70Y7Rh9C10L3QuNGPXG4gIFJFQ09OTkVDVF9ERUxBWTogMjAwMCwgICAgIC8vINCX0LDQtNC10YDQttC60LAg0LzQtdC20LTRgyDQv9C+0L/Ri9GC0LrQsNC80Lgg0L/QtdGA0LXQv9C+0LTQutC70Y7Rh9C10L3QuNGPICgyINGB0LXQutGD0L3QtNGLKVxuICBcbiAgLy8g0J3QsNGB0YLRgNC+0LnQutC4INCx0LjQu9C10YLQvtCyXG4gIFRJQ0tFVFM6IHtcbiAgICAvLyDQkNC60YLQuNCy0L3Ri9C1INCx0LjQu9C10YLRiyDQtNC70Y8g0LjQs9GA0YsgKNGB0LPQvtGA0LDRjtGCINC/0YDQuCDQuNGB0L/QvtC70YzQt9C+0LLQsNC90LjQuClcbiAgICBHQU1FOiB7XG4gICAgICBDT1NUOiAxLCAgICAgICAgICAgICAgLy8g0KHRgtC+0LjQvNC+0YHRgtGMINGD0YfQsNGB0YLQuNGPICgxINCx0LjQu9C10YIpXG4gICAgICBGSUVMRF9OQU1FOiAnY2hhbmNlJyAvLyDQndCw0LfQstCw0L3QuNC1INC/0L7Qu9GPINCyIEFQSSDQuCDQsdCw0LfQtSDQtNCw0L3QvdGL0YVcbiAgICB9LFxuICAgIFxuICAgIC8vINCf0LDRgdGB0LjQstC90YvQtSDQsdC40LvQtdGC0YsgVE9OT1QgQ0hBTkNFICjQvdCw0YfQuNGB0LvRj9GO0YLRgdGPINC30LAg0L/RgNC+0LjQs9GA0YvRiClcbiAgICBUT05PVF9DSEFOQ0U6IHtcbiAgICAgIFJFV0FSRDogMSwgICAgICAgICAgICAgICAgICAgICAgICAvLyDQmtC+0LvQuNGH0LXRgdGC0LLQviDQsdC40LvQtdGC0L7QsiDQt9CwINC/0YDQvtC40LPRgNGL0YhcbiAgICAgIEZJRUxEX05BTUU6ICd0b25vdENoYW5jZVRpY2tldHMnICAvLyDQndCw0LfQstCw0L3QuNC1INC/0L7Qu9GPINCyIEFQSSDQuCDQsdCw0LfQtSDQtNCw0L3QvdGL0YVcbiAgICB9XG4gIH0sXG5cbiAgLy8g0J3QsNGB0YLRgNC+0LnQutC4INC80LDRgtGH0LBcbiAgTUFUQ0g6IHtcbiAgICBNSU5fUExBWUVSUzogMTAsXG4gICAgTUFYX1BMQVlFUlM6IDEwLFxuICAgIFRJTUVPVVQ6IDMwMDAwMCwgLy8gNSDQvNC40L3Rg9GCXG4gICAgUVVFVUVfVElNRU9VVDogNjAwMDAwIC8vIDEwINC80LjQvdGD0YJcbiAgfSxcblxuICAvLyDQndCw0YHRgtGA0L7QudC60Lgg0L/RgNC40LfQvtCyXG4gIFBSSVpFUzoge1xuICAgIEZJUlNUOiA0NTAsICAgLy8gNTAlINC+0YIgOTAwXG4gICAgU0VDT05EOiAyNzAsICAvLyAzMCUg0L7RgiA5MDBcbiAgICBUSElSRDogMTgwLCAgIC8vIDIwJSDQvtGCIDkwMFxuICAgIENPTlNPTEFUSU9OX1RJQ0tFVDogMSAgLy8g0KPRgtC10YjQuNGC0LXQu9GM0L3Ri9C5INCx0LjQu9C10YIg0LTQu9GPINC/0YDQvtC40LPRgNCw0LLRiNC40YVcbiAgfSxcblxuICAvLyDQotCw0LnQvNC40L3Qs9C4INCw0L3QuNC80LDRhtC40LlcbiAgR0FNRV9USU1JTkdTOiB7XG4gICAgUFJFUEFSSU5HOiA1MDAwLCAgICAvLyA1INGB0LXQutGD0L3QtCBjb3VudGRvd25cbiAgICBNRVJHSU5HOiA3NTAwLCAgICAgIC8vIDcuNSDRgdC10LrRg9C90LQgKDEwINCx0LjQu9C10YLQvtCyICogMSDRgdC10LogLyAxLjI1INGB0LrQvtGA0L7RgdGC0YwpXG4gICAgV0hFRUxfQVBQRUFSOiA0MDAwLCAvLyA0INGB0LXQutGD0L3QtNGLXG4gICAgV0hFRUxfU1BJTjogNzAwMCwgICAvLyA3INGB0LXQutGD0L3QtFxuICAgIFdIRUVMX1NUT1A6IDIwMDAsICAgLy8gMiDRgdC10LrRg9C90LTRi1xuICAgIFJFU1VMVDogMTAwMCAgICAgICAgLy8gMSDRgdC10LrRg9C90LTQsFxuICB9IGFzIGNvbnN0XG59IGFzIGNvbnN0O1xuXG4vLyDQrdC60YHQv9C+0YDRgtC40YDRg9C10Lwg0YLQsNC60LbQtSDQvtGC0LTQtdC70YzQvdGL0LUg0LrQvtC90YHRgtCw0L3RgtGLINC00LvRjyDQvtCx0YDQsNGC0L3QvtC5INGB0L7QstC80LXRgdGC0LjQvNC+0YHRgtC4XG5leHBvcnQgY29uc3QgTUFYX1BMQVlFUlMgPSBYMTBfQ09ORklHLk1BWF9QTEFZRVJTO1xuZXhwb3J0IGNvbnN0IE1JTl9QTEFZRVJTID0gWDEwX0NPTkZJRy5NSU5fUExBWUVSUztcbmV4cG9ydCBjb25zdCBNQVRDSF9USU1FT1VUID0gWDEwX0NPTkZJRy5NQVRDSF9USU1FT1VUO1xuZXhwb3J0IGNvbnN0IFFVRVVFX1RJTUVPVVQgPSBYMTBfQ09ORklHLlFVRVVFX1RJTUVPVVQ7XG5cbi8qKlxuICog0JrQvtC90YTQuNCz0YPRgNCw0YbQuNGPINC00LvRjyDRgNCw0LHQvtGC0Ysg0YEgVE9OXG4gKi9cbmV4cG9ydCBjb25zdCBUT05fQ09ORklHID0ge1xuICAvLyDQkNC00YDQtdGBIFRPTiDQutC+0YjQtdC70YzQutCwINC/0YDQuNC70L7QttC10L3QuNGPXG4gIFdBTExFVF9BRERSRVNTOiBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19XQUxMRVRfQUREUkVTUyB8fCBDT05GSUcuV0FMTEVUX0FERFJFU1MsXG4gIFxuICAvLyDQkNC00YDQtdGBINC60L7RiNC10LvRjNC60LAg0YDQsNC30YDQsNCx0L7RgtGH0LjQutCwXG4gIERFVkVMT1BFUl9BRERSRVNTOiBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19ERVZFTE9QRVJfQUREUkVTUyB8fCBDT05GSUcuREVWRUxPUEVSX0FERFJFU1MsXG4gIFxuICAvLyBBUEkg0LrQu9GO0Ycg0LTQu9GPIFRPTlxuICBBUElfS0VZOiBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19UT05fQVBJX0tFWSB8fCBDT05GSUcuVE9OX0FQSV9LRVlcbn07XG5cbi8vINCU0YDRg9Cz0LjQtSDQvdCw0YHRgtGA0L7QudC60Lgg0L/RgNC40LvQvtC20LXQvdC40Y9cbmV4cG9ydCBjb25zdCBBUFBfQ09ORklHID0ge1xuICBidWlsZFRpbWVEQkNvbm5lY3Rpb246IHByb2Nlc3MuZW52LlNLSVBfREJfQ09OTkVDVElPTl9EVVJJTkdfQlVJTEQgIT09ICd0cnVlJ1xufTtcblxuLy8g0JTQvtCx0LDQstC70Y/QtdC8INC60L7QvdGE0LjQs9GD0YDQsNGG0LjRjiDQtNC70Y8g0YDQtdC20LjQvNCwINGB0LjQvNGD0LvRj9GG0LjQuFxuZXhwb3J0IGNvbnN0IElTX0RFVl9NT0RFID0gcHJvY2Vzcy5lbnYuTk9ERV9FTlYgPT09ICdkZXZlbG9wbWVudCc7XG5cbmV4cG9ydCBkZWZhdWx0IENPTkZJRzsgIl0sIm5hbWVzIjpbIkNPTkZJRyIsIldBTExFVF9BRERSRVNTIiwicHJvY2VzcyIsImVudiIsIk5FWFRfUFVCTElDX1dBTExFVF9BRERSRVNTIiwiREVWRUxPUEVSX0FERFJFU1MiLCJORVhUX1BVQkxJQ19ERVZFTE9QRVJfQUREUkVTUyIsIk5FVFdPUksiLCJORVhUX1BVQkxJQ19ORVRXT1JLIiwiVE9OX0FQSV9LRVkiLCJORVhUX1BVQkxJQ19UT05fQVBJX0tFWSIsIkFQUF9VUkwiLCJORVhUX1BVQkxJQ19BUFBfVVJMIiwiQVBJX1VSTCIsIk5FWFRfUFVCTElDX0FQSV9VUkwiLCJNT05HT0RCX1VSSSIsIlRJQ0tFVF9QUklDRSIsIk51bWJlciIsIk5FWFRfUFVCTElDX1RJQ0tFVF9QUklDRSIsIlBMQVRGT1JNX0ZFRSIsIk5FWFRfUFVCTElDX1BMQVRGT1JNX0ZFRSIsIlNUT1JBR0VfS0VZUyIsIkFVVEgiLCJVU0VSIiwiVEhFTUUiLCJMQU5HIiwiVEVMRUdSQU1fVVNFUiIsIkFDQ0VTU19UT0tFTiIsIlRJQ0tFVFMiLCJUT05PVF9DSEFOQ0VfVElDS0VUUyIsIlgxMF9HQU1FX1NUQVRFIiwiTUFYX0RCX0NPTk5FQ1RfUkVUUklFUyIsIkRCX1JFVFJZX0RFTEFZIiwiQVBJX0VORFBPSU5UUyIsIlVTRVJfREFUQSIsIlgyIiwiR0FNRSIsIkNSRUFURSIsIkNBTkNFTCIsIkNPTVBMRVRFIiwiWDEwIiwiU09DS0VUX1VSTCIsIk5FWFRfUFVCTElDX1NPQ0tFVF9VUkwiLCJTT0NLRVRfQ09ORklHIiwiY29ycyIsIm9yaWdpbiIsIlNPQ0tFVF9DT1JTX09SSUdJTiIsIm1ldGhvZHMiLCJjcmVkZW50aWFscyIsInBpbmdUaW1lb3V0IiwicGluZ0ludGVydmFsIiwiY29ubmVjdFRpbWVvdXQiLCJyZWNvbm5lY3Rpb24iLCJyZWNvbm5lY3Rpb25BdHRlbXB0cyIsInJlY29ubmVjdGlvbkRlbGF5Iiwid2FpdGluZ1RpbWVvdXQiLCJtYXRjaFRpbWVvdXQiLCJjb3VudGRvd25UaW1lIiwiWDEwX0NPTkZJRyIsIk1JTl9QTEFZRVJTIiwiTUFYX1BMQVlFUlMiLCJXSU5ORVJTX0NPVU5UIiwiUExBWUVSUyIsIk1JTiIsIk1BWCIsIlBSSVpFX0RJU1RSSUJVVElPTiIsIkZJUlNUX1BMQUNFIiwiU0VDT05EX1BMQUNFIiwiVEhJUkRfUExBQ0UiLCJRVUVVRV9USU1FT1VUIiwiTUFUQ0hfVElNRU9VVCIsIkNPVU5URE9XTl9USU1FIiwiTUFYX1JFQ09OTkVDVF9BVFRFTVBUUyIsIlJFQ09OTkVDVF9ERUxBWSIsIkNPU1QiLCJGSUVMRF9OQU1FIiwiVE9OT1RfQ0hBTkNFIiwiUkVXQVJEIiwiTUFUQ0giLCJUSU1FT1VUIiwiUFJJWkVTIiwiRklSU1QiLCJTRUNPTkQiLCJUSElSRCIsIkNPTlNPTEFUSU9OX1RJQ0tFVCIsIkdBTUVfVElNSU5HUyIsIlBSRVBBUklORyIsIk1FUkdJTkciLCJXSEVFTF9BUFBFQVIiLCJXSEVFTF9TUElOIiwiV0hFRUxfU1RPUCIsIlJFU1VMVCIsIlRPTl9DT05GSUciLCJBUElfS0VZIiwiQVBQX0NPTkZJRyIsImJ1aWxkVGltZURCQ29ubmVjdGlvbiIsIlNLSVBfREJfQ09OTkVDVElPTl9EVVJJTkdfQlVJTEQiLCJJU19ERVZfTU9ERSJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/config.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/db.js":
/*!***********************!*\
  !*** ./src/lib/db.js ***!
  \***********************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   connectToDatabase: () => (/* binding */ connectToDatabase),\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__),\n/* harmony export */   ensureDbConnected: () => (/* binding */ ensureDbConnected)\n/* harmony export */ });\n/* harmony import */ var mongoose__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! mongoose */ \"mongoose\");\n/* harmony import */ var mongoose__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(mongoose__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var _config__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! ./config */ \"(rsc)/./src/lib/config.ts\");\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/next/dist/api/server.js\");\n\n\n\nconst MONGODB_URI = _config__WEBPACK_IMPORTED_MODULE_1__.CONFIG.MONGODB_URI;\n// Логгирование информации о подключении\nconsole.log(\"[DB] Строка подключения MongoDB (без пароля):\", MONGODB_URI?.includes(\"@\") ? MONGODB_URI.split(\"@\")[1] : \"Не задана\");\nconsole.log(\"[DB] Кластер в URI:\", MONGODB_URI?.includes(\"cluster0\") ? \"cluster0\" : \"Нет кластера\");\n// Кеш подключения к MongoDB для повторного использования между функциями API\nlet cachedConnection = null;\n// Функция, определяющая окружение выполнения\nfunction isServerSideRendering() {\n    // Vercel использует переменную VERCEL=1 в production среде\n    return !process.env.VERCEL && \"development\" === \"development\" && \"undefined\" === \"undefined\" && !global.isConnecting;\n}\n/**\n * Подключение к MongoDB, с кешированием соединения\n * @returns {Promise<{db: any, connection: typeof mongoose}>} Mongoose connection и объект базы данных\n */ async function connectToDatabase() {\n    console.log(\"[DB] Инициализация кеша подключения к MongoDB\");\n    // Проверяем наличие строки подключения\n    if (!MONGODB_URI) {\n        console.error(\"[DB] ОШИБКА: MONGODB_URI не установлен. Проверьте переменные окружения\");\n        throw new Error(\"[DB] MONGODB_URI не установлен\");\n    }\n    // Если окружение серверного рендеринга, не подключаемся к базе данных\n    if (isServerSideRendering()) {\n        console.log(\"[DB] Пропускаем подключение к MongoDB во время серверного рендеринга\");\n        return {\n            db: null,\n            connection: null\n        };\n    }\n    // Если соединение уже установлено или в процессе установки, используем его\n    if (cachedConnection) {\n        console.log(\"[DB] Используем существующее подключение к MongoDB\");\n        return {\n            db: cachedConnection.connection.db,\n            connection: cachedConnection\n        };\n    }\n    try {\n        console.log(\"[DB] Устанавливаем новое подключение к MongoDB...\");\n        // Устанавливаем флаг подключения, чтобы избежать параллельных подключений\n        global.isConnecting = true;\n        // Устанавливаем соединение\n        const options = {\n            connectTimeoutMS: 10000,\n            serverSelectionTimeoutMS: 10000\n        };\n        cachedConnection = await mongoose__WEBPACK_IMPORTED_MODULE_0___default().connect(MONGODB_URI, options);\n        console.log(\"[DB] Успешно подключились к MongoDB!\");\n        // Сбрасываем флаг подключения\n        global.isConnecting = false;\n        return {\n            db: cachedConnection.connection.db,\n            connection: cachedConnection\n        };\n    } catch (error) {\n        console.error(\"[DB] ОШИБКА подключения к MongoDB:\", error.message);\n        // Сбрасываем флаг подключения и кеш при ошибке\n        global.isConnecting = false;\n        cachedConnection = null;\n        throw error;\n    }\n}\n/**\n * Обертка для API маршрутов Next.js App Router, которая обеспечивает подключение к базе данных \n * перед выполнением обработчика\n * @param {Function} handler Функция обработчик API запроса\n * @returns {Function} Обернутая функция с подключением к базе данных\n */ function ensureDbConnected(handler) {\n    return async (request, context)=>{\n        try {\n            await connectToDatabase();\n            return handler(request, context);\n        } catch (error) {\n            console.error(\"[DB] Ошибка в обработчике API:\", error.message);\n            return next_server__WEBPACK_IMPORTED_MODULE_2__.NextResponse.json({\n                error: \"Ошибка подключения к базе данных\"\n            }, {\n                status: 500\n            });\n        }\n    };\n}\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = ((mongoose__WEBPACK_IMPORTED_MODULE_0___default()));\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvbGliL2RiLmpzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7QUFBZ0M7QUFDRTtBQUNTO0FBRTNDLE1BQU1HLGNBQWNGLDJDQUFNQSxDQUFDRSxXQUFXO0FBRXRDLHdDQUF3QztBQUN4Q0MsUUFBUUMsR0FBRyxDQUFDLGlEQUFpREYsYUFBYUcsU0FBUyxPQUFPSCxZQUFZSSxLQUFLLENBQUMsSUFBSSxDQUFDLEVBQUUsR0FBRztBQUN0SEgsUUFBUUMsR0FBRyxDQUFDLHVCQUF1QkYsYUFBYUcsU0FBUyxjQUFjLGFBQWE7QUFFcEYsNkVBQTZFO0FBQzdFLElBQUlFLG1CQUFtQjtBQUV2Qiw2Q0FBNkM7QUFDN0MsU0FBU0M7SUFDUCwyREFBMkQ7SUFDM0QsT0FBTyxDQUFDQyxRQUFRQyxHQUFHLENBQUNDLE1BQU0sSUFBSUYsa0JBQXlCLGlCQUFpQixnQkFBa0IsZUFBZSxDQUFDRyxPQUFPQyxZQUFZO0FBQy9IO0FBRUE7OztDQUdDLEdBQ00sZUFBZUM7SUFDcEJYLFFBQVFDLEdBQUcsQ0FBQztJQUVaLHVDQUF1QztJQUN2QyxJQUFJLENBQUNGLGFBQWE7UUFDaEJDLFFBQVFZLEtBQUssQ0FBQztRQUNkLE1BQU0sSUFBSUMsTUFBTTtJQUNsQjtJQUVBLHNFQUFzRTtJQUN0RSxJQUFJUix5QkFBeUI7UUFDM0JMLFFBQVFDLEdBQUcsQ0FBQztRQUNaLE9BQU87WUFBRWEsSUFBSTtZQUFNQyxZQUFZO1FBQUs7SUFDdEM7SUFFQSwyRUFBMkU7SUFDM0UsSUFBSVgsa0JBQWtCO1FBQ3BCSixRQUFRQyxHQUFHLENBQUM7UUFDWixPQUFPO1lBQ0xhLElBQUlWLGlCQUFpQlcsVUFBVSxDQUFDRCxFQUFFO1lBQ2xDQyxZQUFZWDtRQUNkO0lBQ0Y7SUFFQSxJQUFJO1FBQ0ZKLFFBQVFDLEdBQUcsQ0FBQztRQUVaLDBFQUEwRTtRQUMxRVEsT0FBT0MsWUFBWSxHQUFHO1FBRXRCLDJCQUEyQjtRQUMzQixNQUFNTSxVQUFVO1lBQ2RDLGtCQUFrQjtZQUNsQkMsMEJBQTBCO1FBQzVCO1FBRUFkLG1CQUFtQixNQUFNUix1REFBZ0IsQ0FBQ0csYUFBYWlCO1FBQ3ZEaEIsUUFBUUMsR0FBRyxDQUFDO1FBRVosOEJBQThCO1FBQzlCUSxPQUFPQyxZQUFZLEdBQUc7UUFFdEIsT0FBTztZQUNMSSxJQUFJVixpQkFBaUJXLFVBQVUsQ0FBQ0QsRUFBRTtZQUNsQ0MsWUFBWVg7UUFDZDtJQUNGLEVBQUUsT0FBT1EsT0FBTztRQUNkWixRQUFRWSxLQUFLLENBQUMsc0NBQXNDQSxNQUFNUSxPQUFPO1FBRWpFLCtDQUErQztRQUMvQ1gsT0FBT0MsWUFBWSxHQUFHO1FBQ3RCTixtQkFBbUI7UUFFbkIsTUFBTVE7SUFDUjtBQUNGO0FBRUE7Ozs7O0NBS0MsR0FDTSxTQUFTUyxrQkFBa0JDLE9BQU87SUFDdkMsT0FBTyxPQUFPQyxTQUFTQztRQUNyQixJQUFJO1lBQ0YsTUFBTWI7WUFDTixPQUFPVyxRQUFRQyxTQUFTQztRQUMxQixFQUFFLE9BQU9aLE9BQU87WUFDZFosUUFBUVksS0FBSyxDQUFDLGtDQUFrQ0EsTUFBTVEsT0FBTztZQUM3RCxPQUFPdEIscURBQVlBLENBQUMyQixJQUFJLENBQUM7Z0JBQUViLE9BQU87WUFBbUMsR0FBRztnQkFBRWMsUUFBUTtZQUFJO1FBQ3hGO0lBQ0Y7QUFDRjtBQUVBLGlFQUFlOUIsaURBQVFBLEVBQUMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9uZXh0anMtdGVtcGxhdGUvLi9zcmMvbGliL2RiLmpzPzdmOWEiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IG1vbmdvb3NlIGZyb20gJ21vbmdvb3NlJztcbmltcG9ydCB7IENPTkZJRyB9IGZyb20gJy4vY29uZmlnJztcbmltcG9ydCB7IE5leHRSZXNwb25zZSB9IGZyb20gJ25leHQvc2VydmVyJztcblxuY29uc3QgTU9OR09EQl9VUkkgPSBDT05GSUcuTU9OR09EQl9VUkk7XG5cbi8vINCb0L7Qs9Cz0LjRgNC+0LLQsNC90LjQtSDQuNC90YTQvtGA0LzQsNGG0LjQuCDQviDQv9C+0LTQutC70Y7Rh9C10L3QuNC4XG5jb25zb2xlLmxvZygnW0RCXSDQodGC0YDQvtC60LAg0L/QvtC00LrQu9GO0YfQtdC90LjRjyBNb25nb0RCICjQsdC10Lcg0L/QsNGA0L7Qu9GPKTonLCBNT05HT0RCX1VSST8uaW5jbHVkZXMoJ0AnKSA/IE1PTkdPREJfVVJJLnNwbGl0KCdAJylbMV0gOiAn0J3QtSDQt9Cw0LTQsNC90LAnKTtcbmNvbnNvbGUubG9nKCdbREJdINCa0LvQsNGB0YLQtdGAINCyIFVSSTonLCBNT05HT0RCX1VSST8uaW5jbHVkZXMoJ2NsdXN0ZXIwJykgPyAnY2x1c3RlcjAnIDogJ9Cd0LXRgiDQutC70LDRgdGC0LXRgNCwJyk7XG5cbi8vINCa0LXRiCDQv9C+0LTQutC70Y7Rh9C10L3QuNGPINC6IE1vbmdvREIg0LTQu9GPINC/0L7QstGC0L7RgNC90L7Qs9C+INC40YHQv9C+0LvRjNC30L7QstCw0L3QuNGPINC80LXQttC00YMg0YTRg9C90LrRhtC40Y/QvNC4IEFQSVxubGV0IGNhY2hlZENvbm5lY3Rpb24gPSBudWxsO1xuXG4vLyDQpNGD0L3QutGG0LjRjywg0L7Qv9GA0LXQtNC10LvRj9GO0YnQsNGPINC+0LrRgNGD0LbQtdC90LjQtSDQstGL0L/QvtC70L3QtdC90LjRj1xuZnVuY3Rpb24gaXNTZXJ2ZXJTaWRlUmVuZGVyaW5nKCkge1xuICAvLyBWZXJjZWwg0LjRgdC/0L7Qu9GM0LfRg9C10YIg0L/QtdGA0LXQvNC10L3QvdGD0Y4gVkVSQ0VMPTEg0LIgcHJvZHVjdGlvbiDRgdGA0LXQtNC1XG4gIHJldHVybiAhcHJvY2Vzcy5lbnYuVkVSQ0VMICYmIHByb2Nlc3MuZW52Lk5PREVfRU5WID09PSAnZGV2ZWxvcG1lbnQnICYmIHR5cGVvZiB3aW5kb3cgPT09ICd1bmRlZmluZWQnICYmICFnbG9iYWwuaXNDb25uZWN0aW5nO1xufVxuXG4vKipcbiAqINCf0L7QtNC60LvRjtGH0LXQvdC40LUg0LogTW9uZ29EQiwg0YEg0LrQtdGI0LjRgNC+0LLQsNC90LjQtdC8INGB0L7QtdC00LjQvdC10L3QuNGPXG4gKiBAcmV0dXJucyB7UHJvbWlzZTx7ZGI6IGFueSwgY29ubmVjdGlvbjogdHlwZW9mIG1vbmdvb3NlfT59IE1vbmdvb3NlIGNvbm5lY3Rpb24g0Lgg0L7QsdGK0LXQutGCINCx0LDQt9GLINC00LDQvdC90YvRhVxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gY29ubmVjdFRvRGF0YWJhc2UoKSB7XG4gIGNvbnNvbGUubG9nKCdbREJdINCY0L3QuNGG0LjQsNC70LjQt9Cw0YbQuNGPINC60LXRiNCwINC/0L7QtNC60LvRjtGH0LXQvdC40Y8g0LogTW9uZ29EQicpO1xuICBcbiAgLy8g0J/RgNC+0LLQtdGA0Y/QtdC8INC90LDQu9C40YfQuNC1INGB0YLRgNC+0LrQuCDQv9C+0LTQutC70Y7Rh9C10L3QuNGPXG4gIGlmICghTU9OR09EQl9VUkkpIHtcbiAgICBjb25zb2xlLmVycm9yKCdbREJdINCe0KjQmNCR0JrQkDogTU9OR09EQl9VUkkg0L3QtSDRg9GB0YLQsNC90L7QstC70LXQvS4g0J/RgNC+0LLQtdGA0YzRgtC1INC/0LXRgNC10LzQtdC90L3Ri9C1INC+0LrRgNGD0LbQtdC90LjRjycpO1xuICAgIHRocm93IG5ldyBFcnJvcignW0RCXSBNT05HT0RCX1VSSSDQvdC1INGD0YHRgtCw0L3QvtCy0LvQtdC9Jyk7XG4gIH1cbiAgXG4gIC8vINCV0YHQu9C4INC+0LrRgNGD0LbQtdC90LjQtSDRgdC10YDQstC10YDQvdC+0LPQviDRgNC10L3QtNC10YDQuNC90LPQsCwg0L3QtSDQv9C+0LTQutC70Y7Rh9Cw0LXQvNGB0Y8g0Log0LHQsNC30LUg0LTQsNC90L3Ri9GFXG4gIGlmIChpc1NlcnZlclNpZGVSZW5kZXJpbmcoKSkge1xuICAgIGNvbnNvbGUubG9nKCdbREJdINCf0YDQvtC/0YPRgdC60LDQtdC8INC/0L7QtNC60LvRjtGH0LXQvdC40LUg0LogTW9uZ29EQiDQstC+INCy0YDQtdC80Y8g0YHQtdGA0LLQtdGA0L3QvtCz0L4g0YDQtdC90LTQtdGA0LjQvdCz0LAnKTtcbiAgICByZXR1cm4geyBkYjogbnVsbCwgY29ubmVjdGlvbjogbnVsbCB9O1xuICB9XG5cbiAgLy8g0JXRgdC70Lgg0YHQvtC10LTQuNC90LXQvdC40LUg0YPQttC1INGD0YHRgtCw0L3QvtCy0LvQtdC90L4g0LjQu9C4INCyINC/0YDQvtGG0LXRgdGB0LUg0YPRgdGC0LDQvdC+0LLQutC4LCDQuNGB0L/QvtC70YzQt9GD0LXQvCDQtdCz0L5cbiAgaWYgKGNhY2hlZENvbm5lY3Rpb24pIHtcbiAgICBjb25zb2xlLmxvZygnW0RCXSDQmNGB0L/QvtC70YzQt9GD0LXQvCDRgdGD0YnQtdGB0YLQstGD0Y7RidC10LUg0L/QvtC00LrQu9GO0YfQtdC90LjQtSDQuiBNb25nb0RCJyk7XG4gICAgcmV0dXJuIHsgXG4gICAgICBkYjogY2FjaGVkQ29ubmVjdGlvbi5jb25uZWN0aW9uLmRiLFxuICAgICAgY29ubmVjdGlvbjogY2FjaGVkQ29ubmVjdGlvbiBcbiAgICB9O1xuICB9XG5cbiAgdHJ5IHtcbiAgICBjb25zb2xlLmxvZygnW0RCXSDQo9GB0YLQsNC90LDQstC70LjQstCw0LXQvCDQvdC+0LLQvtC1INC/0L7QtNC60LvRjtGH0LXQvdC40LUg0LogTW9uZ29EQi4uLicpO1xuICAgIFxuICAgIC8vINCj0YHRgtCw0L3QsNCy0LvQuNCy0LDQtdC8INGE0LvQsNCzINC/0L7QtNC60LvRjtGH0LXQvdC40Y8sINGH0YLQvtCx0Ysg0LjQt9Cx0LXQttCw0YLRjCDQv9Cw0YDQsNC70LvQtdC70YzQvdGL0YUg0L/QvtC00LrQu9GO0YfQtdC90LjQuVxuICAgIGdsb2JhbC5pc0Nvbm5lY3RpbmcgPSB0cnVlO1xuICAgIFxuICAgIC8vINCj0YHRgtCw0L3QsNCy0LvQuNCy0LDQtdC8INGB0L7QtdC00LjQvdC10L3QuNC1XG4gICAgY29uc3Qgb3B0aW9ucyA9IHtcbiAgICAgIGNvbm5lY3RUaW1lb3V0TVM6IDEwMDAwLCAvLyAxMCDRgdC10LrRg9C90LQg0YLQsNC50LzQsNGD0YJcbiAgICAgIHNlcnZlclNlbGVjdGlvblRpbWVvdXRNUzogMTAwMDAsIC8vIDEwINGB0LXQutGD0L3QtCDRgtCw0LnQvNCw0YPRglxuICAgIH07XG4gICAgXG4gICAgY2FjaGVkQ29ubmVjdGlvbiA9IGF3YWl0IG1vbmdvb3NlLmNvbm5lY3QoTU9OR09EQl9VUkksIG9wdGlvbnMpO1xuICAgIGNvbnNvbGUubG9nKCdbREJdINCj0YHQv9C10YjQvdC+INC/0L7QtNC60LvRjtGH0LjQu9C40YHRjCDQuiBNb25nb0RCIScpO1xuICAgIFxuICAgIC8vINCh0LHRgNCw0YHRi9Cy0LDQtdC8INGE0LvQsNCzINC/0L7QtNC60LvRjtGH0LXQvdC40Y9cbiAgICBnbG9iYWwuaXNDb25uZWN0aW5nID0gZmFsc2U7XG4gICAgXG4gICAgcmV0dXJuIHsgXG4gICAgICBkYjogY2FjaGVkQ29ubmVjdGlvbi5jb25uZWN0aW9uLmRiLFxuICAgICAgY29ubmVjdGlvbjogY2FjaGVkQ29ubmVjdGlvbiBcbiAgICB9O1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ1tEQl0g0J7QqNCY0JHQmtCQINC/0L7QtNC60LvRjtGH0LXQvdC40Y8g0LogTW9uZ29EQjonLCBlcnJvci5tZXNzYWdlKTtcbiAgICBcbiAgICAvLyDQodCx0YDQsNGB0YvQstCw0LXQvCDRhNC70LDQsyDQv9C+0LTQutC70Y7Rh9C10L3QuNGPINC4INC60LXRiCDQv9GA0Lgg0L7RiNC40LHQutC1XG4gICAgZ2xvYmFsLmlzQ29ubmVjdGluZyA9IGZhbHNlO1xuICAgIGNhY2hlZENvbm5lY3Rpb24gPSBudWxsO1xuICAgIFxuICAgIHRocm93IGVycm9yO1xuICB9XG59XG5cbi8qKlxuICog0J7QsdC10YDRgtC60LAg0LTQu9GPIEFQSSDQvNCw0YDRiNGA0YPRgtC+0LIgTmV4dC5qcyBBcHAgUm91dGVyLCDQutC+0YLQvtGA0LDRjyDQvtCx0LXRgdC/0LXRh9C40LLQsNC10YIg0L/QvtC00LrQu9GO0YfQtdC90LjQtSDQuiDQsdCw0LfQtSDQtNCw0L3QvdGL0YUgXG4gKiDQv9C10YDQtdC0INCy0YvQv9C+0LvQvdC10L3QuNC10Lwg0L7QsdGA0LDQsdC+0YLRh9C40LrQsFxuICogQHBhcmFtIHtGdW5jdGlvbn0gaGFuZGxlciDQpNGD0L3QutGG0LjRjyDQvtCx0YDQsNCx0L7RgtGH0LjQuiBBUEkg0LfQsNC/0YDQvtGB0LBcbiAqIEByZXR1cm5zIHtGdW5jdGlvbn0g0J7QsdC10YDQvdGD0YLQsNGPINGE0YPQvdC60YbQuNGPINGBINC/0L7QtNC60LvRjtGH0LXQvdC40LXQvCDQuiDQsdCw0LfQtSDQtNCw0L3QvdGL0YVcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGVuc3VyZURiQ29ubmVjdGVkKGhhbmRsZXIpIHtcbiAgcmV0dXJuIGFzeW5jIChyZXF1ZXN0LCBjb250ZXh0KSA9PiB7XG4gICAgdHJ5IHtcbiAgICAgIGF3YWl0IGNvbm5lY3RUb0RhdGFiYXNlKCk7XG4gICAgICByZXR1cm4gaGFuZGxlcihyZXF1ZXN0LCBjb250ZXh0KTtcbiAgICB9IGNhdGNoIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignW0RCXSDQntGI0LjQsdC60LAg0LIg0L7QsdGA0LDQsdC+0YLRh9C40LrQtSBBUEk6JywgZXJyb3IubWVzc2FnZSk7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBlcnJvcjogJ9Ce0YjQuNCx0LrQsCDQv9C+0LTQutC70Y7Rh9C10L3QuNGPINC6INCx0LDQt9C1INC00LDQvdC90YvRhScgfSwgeyBzdGF0dXM6IDUwMCB9KTtcbiAgICB9XG4gIH07XG59XG5cbmV4cG9ydCBkZWZhdWx0IG1vbmdvb3NlOyAiXSwibmFtZXMiOlsibW9uZ29vc2UiLCJDT05GSUciLCJOZXh0UmVzcG9uc2UiLCJNT05HT0RCX1VSSSIsImNvbnNvbGUiLCJsb2ciLCJpbmNsdWRlcyIsInNwbGl0IiwiY2FjaGVkQ29ubmVjdGlvbiIsImlzU2VydmVyU2lkZVJlbmRlcmluZyIsInByb2Nlc3MiLCJlbnYiLCJWRVJDRUwiLCJnbG9iYWwiLCJpc0Nvbm5lY3RpbmciLCJjb25uZWN0VG9EYXRhYmFzZSIsImVycm9yIiwiRXJyb3IiLCJkYiIsImNvbm5lY3Rpb24iLCJvcHRpb25zIiwiY29ubmVjdFRpbWVvdXRNUyIsInNlcnZlclNlbGVjdGlvblRpbWVvdXRNUyIsImNvbm5lY3QiLCJtZXNzYWdlIiwiZW5zdXJlRGJDb25uZWN0ZWQiLCJoYW5kbGVyIiwicmVxdWVzdCIsImNvbnRleHQiLCJqc29uIiwic3RhdHVzIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/db.js\n");

/***/ }),

/***/ "(rsc)/./src/models/Referral.js":
/*!********************************!*\
  !*** ./src/models/Referral.js ***!
  \********************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var mongoose__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! mongoose */ \"mongoose\");\n/* harmony import */ var mongoose__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(mongoose__WEBPACK_IMPORTED_MODULE_0__);\n\n/**\n * Схема реферала - запись о реферальной связи\n */ const referralSchema = new (mongoose__WEBPACK_IMPORTED_MODULE_0___default().Schema)({\n    // Реферер - пользователь, который пригласил\n    refererId: {\n        type: Number,\n        required: true\n    },\n    // Реферал - приглашенный пользователь\n    referralId: {\n        type: Number,\n        required: true\n    },\n    username: {\n        type: String\n    },\n    firstName: {\n        type: String\n    },\n    lastName: {\n        type: String\n    },\n    photoUrl: {\n        type: String\n    },\n    // Статусы игр (после регистрации)\n    hasPlayedRoomA: {\n        type: Boolean,\n        default: false\n    },\n    hasPlayedRoomB: {\n        type: Boolean,\n        default: false\n    },\n    isValid: {\n        type: Boolean,\n        default: false\n    },\n    // Даты игр\n    roomAPlayedAt: {\n        type: Date\n    },\n    roomBPlayedAt: {\n        type: Date\n    },\n    // Даты\n    createdAt: {\n        type: Date,\n        default: Date.now\n    },\n    validatedAt: {\n        type: Date\n    },\n    // Бонусы\n    bonusGiven: {\n        type: Boolean,\n        default: false\n    },\n    bonusAmount: {\n        type: Number,\n        default: 0\n    }\n}, {\n    timestamps: true,\n    collection: \"referrals\"\n});\n// Перед сохранением проверяем валидность реферала\nreferralSchema.pre(\"save\", function(next) {\n    // Проверяем, что игры были сыграны после создания реферальной связи\n    const now = new Date();\n    // Проверяем игру в комнате A\n    if (this.roomAPlayedAt && this.roomAPlayedAt > this.createdAt) {\n        this.hasPlayedRoomA = true;\n    }\n    // Проверяем игру в комнате B\n    if (this.roomBPlayedAt && this.roomBPlayedAt > this.createdAt) {\n        this.hasPlayedRoomB = true;\n    }\n    // Если обе игры сыграны после регистрации и реферал еще не валиден\n    if (this.hasPlayedRoomA && this.hasPlayedRoomB && !this.isValid) {\n        this.isValid = true;\n        this.validatedAt = now;\n        console.log(`[ReferralModel] Реферал ${this.referralId} стал валидным для реферера ${this.refererId}`, {\n            roomAPlayedAt: this.roomAPlayedAt,\n            roomBPlayedAt: this.roomBPlayedAt,\n            createdAt: this.createdAt,\n            validatedAt: this.validatedAt\n        });\n    }\n    next();\n});\n// Удаляем старый индекс при инициализации модели\nconst dropOldIndex = async ()=>{\n    try {\n        await mongoose__WEBPACK_IMPORTED_MODULE_0___default().connection.collection(\"referrals\").dropIndex(\"referalId_1\");\n        console.log(\"[ReferralModel] ✅ Старый индекс referalId_1 успешно удален\");\n    } catch (error) {\n        // Игнорируем ошибку если индекс не существует\n        console.log(\"[ReferralModel] ℹ️ Старый индекс не найден или уже удален\");\n    }\n};\n// Определяем правильные индексы\nreferralSchema.index({\n    referralId: 1\n}, {\n    unique: true\n});\nreferralSchema.index({\n    refererId: 1,\n    referralId: 1\n}, {\n    unique: true\n});\nreferralSchema.index({\n    refererId: 1,\n    createdAt: -1\n});\nreferralSchema.index({\n    referralId: 1,\n    isValid: 1\n});\n// Методы для проверки и обновления игр\nreferralSchema.methods = {\n    /**\n   * Обновляет статус игры\n   * @param {string} gameType - Тип игры ('A' или 'B')\n   * @param {Date} gameDate - Дата игры\n   */ async updateGameStatus (gameType, gameDate) {\n        if (!gameDate || gameDate <= this.createdAt) {\n            return false;\n        }\n        if (gameType === \"A\" && !this.hasPlayedRoomA) {\n            this.roomAPlayedAt = gameDate;\n            this.markModified(\"roomAPlayedAt\");\n            await this.save();\n            return true;\n        }\n        if (gameType === \"B\" && !this.hasPlayedRoomB) {\n            this.roomBPlayedAt = gameDate;\n            this.markModified(\"roomBPlayedAt\");\n            await this.save();\n            return true;\n        }\n        return false;\n    }\n};\n// Создаем модель\nconst Referral = (mongoose__WEBPACK_IMPORTED_MODULE_0___default().models).Referral || mongoose__WEBPACK_IMPORTED_MODULE_0___default().model(\"Referral\", referralSchema, \"referrals\");\n// Удаляем старый индекс при первой инициализации модели\nif (!(mongoose__WEBPACK_IMPORTED_MODULE_0___default().models).Referral) {\n    dropOldIndex().catch(console.error);\n}\nconsole.log(\"[ReferralModel] Модель Referral инициализирована\");\nconsole.log(\"[ReferralModel] Имя коллекции:\", Referral.collection?.name || \"Неизвестно\");\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (Referral);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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dGVtcGxhdGUvLi9zcmMvbW9kZWxzL1JlZmVycmFsLmpzPzY0YzUiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IG1vbmdvb3NlIGZyb20gJ21vbmdvb3NlJztcblxuLyoqXG4gKiDQodGF0LXQvNCwINGA0LXRhNC10YDQsNC70LAgLSDQt9Cw0L/QuNGB0Ywg0L4g0YDQtdGE0LXRgNCw0LvRjNC90L7QuSDRgdCy0Y/Qt9C4XG4gKi9cbmNvbnN0IHJlZmVycmFsU2NoZW1hID0gbmV3IG1vbmdvb3NlLlNjaGVtYSh7XG4gIC8vINCg0LXRhNC10YDQtdGAIC0g0L/QvtC70YzQt9C+0LLQsNGC0LXQu9GMLCDQutC+0YLQvtGA0YvQuSDQv9GA0LjQs9C70LDRgdC40LtcbiAgcmVmZXJlcklkOiB7IFxuICAgIHR5cGU6IE51bWJlciwgXG4gICAgcmVxdWlyZWQ6IHRydWVcbiAgfSxcbiAgLy8g0KDQtdGE0LXRgNCw0LsgLSDQv9GA0LjQs9C70LDRiNC10L3QvdGL0Lkg0L/QvtC70YzQt9C+0LLQsNGC0LXQu9GMXG4gIHJlZmVycmFsSWQ6IHsgXG4gICAgdHlwZTogTnVtYmVyLCBcbiAgICByZXF1aXJlZDogdHJ1ZVxuICB9LFxuICB1c2VybmFtZTogeyB0eXBlOiBTdHJpbmcgfSxcbiAgZmlyc3ROYW1lOiB7IHR5cGU6IFN0cmluZyB9LFxuICBsYXN0TmFtZTogeyB0eXBlOiBTdHJpbmcgfSxcbiAgcGhvdG9Vcmw6IHsgdHlwZTogU3RyaW5nIH0sXG4gIC8vINCh0YLQsNGC0YPRgdGLINC40LPRgCAo0L/QvtGB0LvQtSDRgNC10LPQuNGB0YLRgNCw0YbQuNC4KVxuICBoYXNQbGF5ZWRSb29tQTogeyB0eXBlOiBCb29sZWFuLCBkZWZhdWx0OiBmYWxzZSB9LFxuICBoYXNQbGF5ZWRSb29tQjogeyB0eXBlOiBCb29sZWFuLCBkZWZhdWx0OiBmYWxzZSB9LFxuICBpc1ZhbGlkOiB7IHR5cGU6IEJvb2xlYW4sIGRlZmF1bHQ6IGZhbHNlIH0sXG4gIC8vINCU0LDRgtGLINC40LPRgFxuICByb29tQVBsYXllZEF0OiB7IHR5cGU6IERhdGUgfSxcbiAgcm9vbUJQbGF5ZWRBdDogeyB0eXBlOiBEYXRlIH0sXG4gIC8vINCU0LDRgtGLXG4gIGNyZWF0ZWRBdDogeyB0eXBlOiBEYXRlLCBkZWZhdWx0OiBEYXRlLm5vdyB9LFxuICB2YWxpZGF0ZWRBdDogeyB0eXBlOiBEYXRlIH0sIC8vINCU0LDRgtCwINC60L7Qs9C00LAg0YHRgtCw0Lsg0LLQsNC70LjQtNC90YvQvFxuICAvLyDQkdC+0L3Rg9GB0YtcbiAgYm9udXNHaXZlbjogeyB0eXBlOiBCb29sZWFuLCBkZWZhdWx0OiBmYWxzZSB9LFxuICBib251c0Ftb3VudDogeyB0eXBlOiBOdW1iZXIsIGRlZmF1bHQ6IDAgfVxufSwgeyBcbiAgdGltZXN0YW1wczogdHJ1ZSwgXG4gIGNvbGxlY3Rpb246ICdyZWZlcnJhbHMnIFxufSk7XG5cbi8vINCf0LXRgNC10LQg0YHQvtGF0YDQsNC90LXQvdC40LXQvCDQv9GA0L7QstC10YDRj9C10Lwg0LLQsNC70LjQtNC90L7RgdGC0Ywg0YDQtdGE0LXRgNCw0LvQsFxucmVmZXJyYWxTY2hlbWEucHJlKCdzYXZlJywgZnVuY3Rpb24obmV4dCkge1xuICAvLyDQn9GA0L7QstC10YDRj9C10LwsINGH0YLQviDQuNCz0YDRiyDQsdGL0LvQuCDRgdGL0LPRgNCw0L3RiyDQv9C+0YHQu9C1INGB0L7Qt9C00LDQvdC40Y8g0YDQtdGE0LXRgNCw0LvRjNC90L7QuSDRgdCy0Y/Qt9C4XG4gIGNvbnN0IG5vdyA9IG5ldyBEYXRlKCk7XG4gIFxuICAvLyDQn9GA0L7QstC10YDRj9C10Lwg0LjQs9GA0YMg0LIg0LrQvtC80L3QsNGC0LUgQVxuICBpZiAodGhpcy5yb29tQVBsYXllZEF0ICYmIHRoaXMucm9vbUFQbGF5ZWRBdCA+IHRoaXMuY3JlYXRlZEF0KSB7XG4gICAgdGhpcy5oYXNQbGF5ZWRSb29tQSA9IHRydWU7XG4gIH1cbiAgXG4gIC8vINCf0YDQvtCy0LXRgNGP0LXQvCDQuNCz0YDRgyDQsiDQutC+0LzQvdCw0YLQtSBCXG4gIGlmICh0aGlzLnJvb21CUGxheWVkQXQgJiYgdGhpcy5yb29tQlBsYXllZEF0ID4gdGhpcy5jcmVhdGVkQXQpIHtcbiAgICB0aGlzLmhhc1BsYXllZFJvb21CID0gdHJ1ZTtcbiAgfVxuICBcbiAgLy8g0JXRgdC70Lgg0L7QsdC1INC40LPRgNGLINGB0YvQs9GA0LDQvdGLINC/0L7RgdC70LUg0YDQtdCz0LjRgdGC0YDQsNGG0LjQuCDQuCDRgNC10YTQtdGA0LDQuyDQtdGJ0LUg0L3QtSDQstCw0LvQuNC00LXQvVxuICBpZiAodGhpcy5oYXNQbGF5ZWRSb29tQSAmJiB0aGlzLmhhc1BsYXllZFJvb21CICYmICF0aGlzLmlzVmFsaWQpIHtcbiAgICB0aGlzLmlzVmFsaWQgPSB0cnVlO1xuICAgIHRoaXMudmFsaWRhdGVkQXQgPSBub3c7XG4gICAgY29uc29sZS5sb2coYFtSZWZlcnJhbE1vZGVsXSDQoNC10YTQtdGA0LDQuyAke3RoaXMucmVmZXJyYWxJZH0g0YHRgtCw0Lsg0LLQsNC70LjQtNC90YvQvCDQtNC70Y8g0YDQtdGE0LXRgNC10YDQsCAke3RoaXMucmVmZXJlcklkfWAsIHtcbiAgICAgIHJvb21BUGxheWVkQXQ6IHRoaXMucm9vbUFQbGF5ZWRBdCxcbiAgICAgIHJvb21CUGxheWVkQXQ6IHRoaXMucm9vbUJQbGF5ZWRBdCxcbiAgICAgIGNyZWF0ZWRBdDogdGhpcy5jcmVhdGVkQXQsXG4gICAgICB2YWxpZGF0ZWRBdDogdGhpcy52YWxpZGF0ZWRBdFxuICAgIH0pO1xuICB9XG4gIG5leHQoKTtcbn0pO1xuXG4vLyDQo9C00LDQu9GP0LXQvCDRgdGC0LDRgNGL0Lkg0LjQvdC00LXQutGBINC/0YDQuCDQuNC90LjRhtC40LDQu9C40LfQsNGG0LjQuCDQvNC+0LTQtdC70LhcbmNvbnN0IGRyb3BPbGRJbmRleCA9IGFzeW5jICgpID0+IHtcbiAgdHJ5IHtcbiAgICBhd2FpdCBtb25nb29zZS5jb25uZWN0aW9uLmNvbGxlY3Rpb24oJ3JlZmVycmFscycpLmRyb3BJbmRleCgncmVmZXJhbElkXzEnKTtcbiAgICBjb25zb2xlLmxvZygnW1JlZmVycmFsTW9kZWxdIOKchSDQodGC0LDRgNGL0Lkg0LjQvdC00LXQutGBIHJlZmVyYWxJZF8xINGD0YHQv9C10YjQvdC+INGD0LTQsNC70LXQvScpO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIC8vINCY0LPQvdC+0YDQuNGA0YPQtdC8INC+0YjQuNCx0LrRgyDQtdGB0LvQuCDQuNC90LTQtdC60YEg0L3QtSDRgdGD0YnQtdGB0YLQstGD0LXRglxuICAgIGNvbnNvbGUubG9nKCdbUmVmZXJyYWxNb2RlbF0g4oS577iPINCh0YLQsNGA0YvQuSDQuNC90LTQtdC60YEg0L3QtSDQvdCw0LnQtNC10L0g0LjQu9C4INGD0LbQtSDRg9C00LDQu9C10L0nKTtcbiAgfVxufTtcblxuLy8g0J7Qv9GA0LXQtNC10LvRj9C10Lwg0L/RgNCw0LLQuNC70YzQvdGL0LUg0LjQvdC00LXQutGB0YtcbnJlZmVycmFsU2NoZW1hLmluZGV4KHsgcmVmZXJyYWxJZDogMSB9LCB7IHVuaXF1ZTogdHJ1ZSB9KTtcbnJlZmVycmFsU2NoZW1hLmluZGV4KHsgcmVmZXJlcklkOiAxLCByZWZlcnJhbElkOiAxIH0sIHsgdW5pcXVlOiB0cnVlIH0pO1xucmVmZXJyYWxTY2hlbWEuaW5kZXgoeyByZWZlcmVySWQ6IDEsIGNyZWF0ZWRBdDogLTEgfSk7XG5yZWZlcnJhbFNjaGVtYS5pbmRleCh7IHJlZmVycmFsSWQ6IDEsIGlzVmFsaWQ6IDEgfSk7XG5cbi8vINCc0LXRgtC+0LTRiyDQtNC70Y8g0L/RgNC+0LLQtdGA0LrQuCDQuCDQvtCx0L3QvtCy0LvQtdC90LjRjyDQuNCz0YBcbnJlZmVycmFsU2NoZW1hLm1ldGhvZHMgPSB7XG4gIC8qKlxuICAgKiDQntCx0L3QvtCy0LvRj9C10YIg0YHRgtCw0YLRg9GBINC40LPRgNGLXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBnYW1lVHlwZSAtINCi0LjQvyDQuNCz0YDRiyAoJ0EnINC40LvQuCAnQicpXG4gICAqIEBwYXJhbSB7RGF0ZX0gZ2FtZURhdGUgLSDQlNCw0YLQsCDQuNCz0YDRi1xuICAgKi9cbiAgYXN5bmMgdXBkYXRlR2FtZVN0YXR1cyhnYW1lVHlwZSwgZ2FtZURhdGUpIHtcbiAgICBpZiAoIWdhbWVEYXRlIHx8IGdhbWVEYXRlIDw9IHRoaXMuY3JlYXRlZEF0KSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuXG4gICAgaWYgKGdhbWVUeXBlID09PSAnQScgJiYgIXRoaXMuaGFzUGxheWVkUm9vbUEpIHtcbiAgICAgIHRoaXMucm9vbUFQbGF5ZWRBdCA9IGdhbWVEYXRlO1xuICAgICAgdGhpcy5tYXJrTW9kaWZpZWQoJ3Jvb21BUGxheWVkQXQnKTtcbiAgICAgIGF3YWl0IHRoaXMuc2F2ZSgpO1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuXG4gICAgaWYgKGdhbWVUeXBlID09PSAnQicgJiYgIXRoaXMuaGFzUGxheWVkUm9vbUIpIHtcbiAgICAgIHRoaXMucm9vbUJQbGF5ZWRBdCA9IGdhbWVEYXRlO1xuICAgICAgdGhpcy5tYXJrTW9kaWZpZWQoJ3Jvb21CUGxheWVkQXQnKTtcbiAgICAgIGF3YWl0IHRoaXMuc2F2ZSgpO1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuXG4gICAgcmV0dXJuIGZhbHNlO1xuICB9XG59O1xuXG4vLyDQodC+0LfQtNCw0LXQvCDQvNC+0LTQtdC70YxcbmNvbnN0IFJlZmVycmFsID0gbW9uZ29vc2UubW9kZWxzLlJlZmVycmFsIHx8IG1vbmdvb3NlLm1vZGVsKCdSZWZlcnJhbCcsIHJlZmVycmFsU2NoZW1hLCAncmVmZXJyYWxzJyk7XG5cbi8vINCj0LTQsNC70Y/QtdC8INGB0YLQsNGA0YvQuSDQuNC90LTQtdC60YEg0L/RgNC4INC/0LXRgNCy0L7QuSDQuNC90LjRhtC40LDQu9C40LfQsNGG0LjQuCDQvNC+0LTQtdC70LhcbmlmICghbW9uZ29vc2UubW9kZWxzLlJlZmVycmFsKSB7XG4gIGRyb3BPbGRJbmRleCgpLmNhdGNoKGNvbnNvbGUuZXJyb3IpO1xufVxuXG5jb25zb2xlLmxvZygnW1JlZmVycmFsTW9kZWxdINCc0L7QtNC10LvRjCBSZWZlcnJhbCDQuNC90LjRhtC40LDQu9C40LfQuNGA0L7QstCw0L3QsCcpO1xuY29uc29sZS5sb2coJ1tSZWZlcnJhbE1vZGVsXSDQmNC80Y8g0LrQvtC70LvQtdC60YbQuNC4OicsIFJlZmVycmFsLmNvbGxlY3Rpb24/Lm5hbWUgfHwgJ9Cd0LXQuNC30LLQtdGB0YLQvdC+Jyk7XG5cbmV4cG9ydCBkZWZhdWx0IFJlZmVycmFsOyAiXSwibmFtZXMiOlsibW9uZ29vc2UiLCJyZWZlcnJhbFNjaGVtYSIsIlNjaGVtYSIsInJlZmVyZXJJZCIsInR5cGUiLCJOdW1iZXIiLCJyZXF1aXJlZCIsInJlZmVycmFsSWQiLCJ1c2VybmFtZSIsIlN0cmluZyIsImZpcnN0TmFtZSIsImxhc3ROYW1lIiwicGhvdG9VcmwiLCJoYXNQbGF5ZWRSb29tQSIsIkJvb2xlYW4iLCJkZWZhdWx0IiwiaGFzUGxheWVkUm9vbUIiLCJpc1ZhbGlkIiwicm9vbUFQbGF5ZWRBdCIsIkRhdGUiLCJyb29tQlBsYXllZEF0IiwiY3JlYXRlZEF0Iiwibm93IiwidmFsaWRhdGVkQXQiLCJib251c0dpdmVuIiwiYm9udXNBbW91bnQiLCJ0aW1lc3RhbXBzIiwiY29sbGVjdGlvbiIsInByZSIsIm5leHQiLCJjb25zb2xlIiwibG9nIiwiZHJvcE9sZEluZGV4IiwiY29ubmVjdGlvbiIsImRyb3BJbmRleCIsImVycm9yIiwiaW5kZXgiLCJ1bmlxdWUiLCJtZXRob2RzIiwidXBkYXRlR2FtZVN0YXR1cyIsImdhbWVUeXBlIiwiZ2FtZURhdGUiLCJtYXJrTW9kaWZpZWQiLCJzYXZlIiwiUmVmZXJyYWwiLCJtb2RlbHMiLCJtb2RlbCIsImNhdGNoIiwibmFtZSJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/models/Referral.js\n");

/***/ }),

/***/ "(rsc)/./src/models/User.js":
/*!****************************!*\
  !*** ./src/models/User.js ***!
  \****************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__)\n/* harmony export */ });\n/* harmony import */ var mongoose__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! mongoose */ \"mongoose\");\n/* harmony import */ var mongoose__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(mongoose__WEBPACK_IMPORTED_MODULE_0__);\n\nconsole.log(\"[UserModel] Инициализация модели пользователя\");\nconst purchaseHistorySchema = new (mongoose__WEBPACK_IMPORTED_MODULE_0___default().Schema)({\n    date: {\n        type: Date,\n        default: Date.now\n    },\n    amount: {\n        type: Number,\n        required: true\n    },\n    tickets: {\n        type: Number,\n        required: true\n    },\n    transactionId: {\n        type: String,\n        required: true\n    }\n});\nconst gameHistorySchema = new (mongoose__WEBPACK_IMPORTED_MODULE_0___default().Schema)({\n    matchId: {\n        type: String,\n        required: true\n    },\n    date: {\n        type: Date,\n        default: Date.now\n    },\n    opponentId: {\n        type: String,\n        required: true\n    },\n    opponentName: {\n        type: String,\n        required: true\n    },\n    result: {\n        type: String,\n        enum: [\n            \"win\",\n            \"lose\"\n        ],\n        required: true\n    },\n    tonotChanceTickets: {\n        type: Number,\n        required: true\n    }\n});\n// Схема для хранения информации о рефералах\nconst referralSchema = new (mongoose__WEBPACK_IMPORTED_MODULE_0___default().Schema)({\n    userId: {\n        type: Number,\n        required: true\n    },\n    username: {\n        type: String\n    },\n    photoUrl: {\n        type: String\n    },\n    hasPlayedRoomA: {\n        type: Boolean,\n        default: false\n    },\n    hasPlayedRoomB: {\n        type: Boolean,\n        default: false\n    },\n    isValid: {\n        type: Boolean,\n        default: false\n    },\n    createdAt: {\n        type: Date,\n        default: Date.now\n    },\n    validatedAt: {\n        type: Date\n    }\n});\nconst userSchema = new (mongoose__WEBPACK_IMPORTED_MODULE_0___default().Schema)({\n    telegramId: {\n        type: Number,\n        required: true\n    },\n    firstName: {\n        type: String\n    },\n    lastName: {\n        type: String\n    },\n    username: {\n        type: String\n    },\n    photoUrl: {\n        type: String\n    },\n    chatId: {\n        type: String\n    },\n    tickets: {\n        type: Number,\n        default: 0\n    },\n    tonotChanceTickets: {\n        type: Number,\n        default: 0\n    },\n    balance: {\n        type: Number,\n        default: 0\n    },\n    tonBalance: {\n        type: Number,\n        default: 0\n    },\n    locale: {\n        type: String,\n        enum: [\n            \"en\",\n            \"ru\"\n        ],\n        default: \"en\"\n    },\n    // Реферальная система\n    referralCode: {\n        type: String\n    },\n    referredBy: [\n        {\n            userId: {\n                type: String,\n                required: true\n            },\n            date: {\n                type: Date,\n                default: Date.now\n            }\n        }\n    ],\n    referrals: [\n        referralSchema\n    ],\n    bonusesReceived: {\n        type: Number,\n        default: 0\n    },\n    totalValidReferrals: {\n        type: Number,\n        default: 0\n    },\n    pendingBonuses: {\n        type: Number,\n        default: 0\n    },\n    channelSubscribed: {\n        type: Boolean,\n        default: false\n    },\n    // История\n    purchaseHistory: [\n        purchaseHistorySchema\n    ],\n    gameHistory: [\n        gameHistorySchema\n    ],\n    createdAt: {\n        type: Date,\n        default: Date.now\n    },\n    updatedAt: {\n        type: Date,\n        default: Date.now\n    }\n}, {\n    timestamps: true,\n    collection: \"users\"\n});\n// Все индексы определяем явно\nuserSchema.index({\n    telegramId: 1\n}, {\n    unique: true\n});\nuserSchema.index({\n    referralCode: 1\n}, {\n    unique: true\n});\nuserSchema.index({\n    referredBy: 1\n});\n// Обновление даты при изменении документа\nuserSchema.pre(\"save\", function(next) {\n    this.updatedAt = new Date();\n    console.log(\"[UserModel] pre-save hook вызван для пользователя с telegramId:\", this.telegramId);\n    next();\n});\n// Методы для работы с рефералами\nuserSchema.methods = {\n    /**\n   * Добавляет нового реферера\n   */ async addReferer (refererId) {\n        // Проверяем, существует ли уже такой реферер\n        const existingReferer = this.referredBy?.find((ref)=>ref.userId === refererId);\n        if (existingReferer) {\n            return false;\n        }\n        // Добавляем нового реферера\n        if (!this.referredBy) {\n            this.referredBy = [];\n        }\n        this.referredBy.push({\n            userId: refererId,\n            date: new Date()\n        });\n        await this.save();\n        return true;\n    },\n    /**\n   * Проверяет, является ли пользователь рефералом для указанного реферера\n   */ isReferralOf (refererId) {\n        return this.referredBy?.some((ref)=>ref.userId === refererId) || false;\n    }\n};\n// Создаем модель только если она еще не существует\nconsole.log(\"[UserModel] Проверка существования модели User...\");\nconst modelExists = (mongoose__WEBPACK_IMPORTED_MODULE_0___default().models).User !== undefined;\nconsole.log(\"[UserModel] Модель User существует:\", modelExists);\n// Явно указываем коллекцию \"users\" и базу данных через опции\nconst User = (mongoose__WEBPACK_IMPORTED_MODULE_0___default().models).User || mongoose__WEBPACK_IMPORTED_MODULE_0___default().model(\"User\", userSchema, \"users\");\nconsole.log(\"[UserModel] Модель User инициализирована\");\nconsole.log(\"[UserModel] Имя коллекции:\", User.collection?.name || \"Неизвестно\");\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (User);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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SSxDQUFDO1lBQ25CdkMsUUFBUW1DO1lBQ1J0RCxNQUFNLElBQUlFO1FBQ1o7UUFFQSxNQUFNLElBQUksQ0FBQ3lELElBQUk7UUFDZixPQUFPO0lBQ1Q7SUFFQTs7R0FFQyxHQUNEQyxjQUFhTixTQUFTO1FBQ3BCLE9BQU8sSUFBSSxDQUFDakIsVUFBVSxFQUFFd0IsS0FBS0osQ0FBQUEsTUFBT0EsSUFBSXRDLE1BQU0sS0FBS21DLGNBQWM7SUFDbkU7QUFDRjtBQUVBLG1EQUFtRDtBQUNuRDFELFFBQVFDLEdBQUcsQ0FBQztBQUNaLE1BQU1pRSxjQUFjbkUsd0RBQWUsQ0FBQ3FFLElBQUksS0FBS0M7QUFDN0NyRSxRQUFRQyxHQUFHLENBQUMsdUNBQXVDaUU7QUFFbkQsNkRBQTZEO0FBQzdELE1BQU1FLE9BQU9yRSx3REFBZSxDQUFDcUUsSUFBSSxJQUFJckUscURBQWMsQ0FBQyxRQUFRaUMsWUFBWTtBQUV4RWhDLFFBQVFDLEdBQUcsQ0FBQztBQUNaRCxRQUFRQyxHQUFHLENBQUMsOEJBQThCbUUsS0FBS2pCLFVBQVUsRUFBRW9CLFFBQVE7QUFFbkUsaUVBQWVILElBQUlBLEVBQUMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9uZXh0anMtdGVtcGxhdGUvLi9zcmMvbW9kZWxzL1VzZXIuanM/N2QwYiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgbW9uZ29vc2UgZnJvbSAnbW9uZ29vc2UnO1xuXG5jb25zb2xlLmxvZygnW1VzZXJNb2RlbF0g0JjQvdC40YbQuNCw0LvQuNC30LDRhtC40Y8g0LzQvtC00LXQu9C4INC/0L7Qu9GM0LfQvtCy0LDRgtC10LvRjycpO1xuXG5jb25zdCBwdXJjaGFzZUhpc3RvcnlTY2hlbWEgPSBuZXcgbW9uZ29vc2UuU2NoZW1hKHtcbiAgZGF0ZTogeyB0eXBlOiBEYXRlLCBkZWZhdWx0OiBEYXRlLm5vdyB9LFxuICBhbW91bnQ6IHsgdHlwZTogTnVtYmVyLCByZXF1aXJlZDogdHJ1ZSB9LFxuICB0aWNrZXRzOiB7IHR5cGU6IE51bWJlciwgcmVxdWlyZWQ6IHRydWUgfSxcbiAgdHJhbnNhY3Rpb25JZDogeyB0eXBlOiBTdHJpbmcsIHJlcXVpcmVkOiB0cnVlIH1cbn0pO1xuXG5jb25zdCBnYW1lSGlzdG9yeVNjaGVtYSA9IG5ldyBtb25nb29zZS5TY2hlbWEoe1xuICBtYXRjaElkOiB7IHR5cGU6IFN0cmluZywgcmVxdWlyZWQ6IHRydWUgfSxcbiAgZGF0ZTogeyB0eXBlOiBEYXRlLCBkZWZhdWx0OiBEYXRlLm5vdyB9LFxuICBvcHBvbmVudElkOiB7IHR5cGU6IFN0cmluZywgcmVxdWlyZWQ6IHRydWUgfSxcbiAgb3Bwb25lbnROYW1lOiB7IHR5cGU6IFN0cmluZywgcmVxdWlyZWQ6IHRydWUgfSxcbiAgcmVzdWx0OiB7IHR5cGU6IFN0cmluZywgZW51bTogWyd3aW4nLCAnbG9zZSddLCByZXF1aXJlZDogdHJ1ZSB9LFxuICB0b25vdENoYW5jZVRpY2tldHM6IHsgdHlwZTogTnVtYmVyLCByZXF1aXJlZDogdHJ1ZSB9XG59KTtcblxuLy8g0KHRhdC10LzQsCDQtNC70Y8g0YXRgNCw0L3QtdC90LjRjyDQuNC90YTQvtGA0LzQsNGG0LjQuCDQviDRgNC10YTQtdGA0LDQu9Cw0YVcbmNvbnN0IHJlZmVycmFsU2NoZW1hID0gbmV3IG1vbmdvb3NlLlNjaGVtYSh7XG4gIHVzZXJJZDogeyB0eXBlOiBOdW1iZXIsIHJlcXVpcmVkOiB0cnVlIH0sXG4gIHVzZXJuYW1lOiB7IHR5cGU6IFN0cmluZyB9LFxuICBwaG90b1VybDogeyB0eXBlOiBTdHJpbmcgfSxcbiAgaGFzUGxheWVkUm9vbUE6IHsgdHlwZTogQm9vbGVhbiwgZGVmYXVsdDogZmFsc2UgfSxcbiAgaGFzUGxheWVkUm9vbUI6IHsgdHlwZTogQm9vbGVhbiwgZGVmYXVsdDogZmFsc2UgfSxcbiAgaXNWYWxpZDogeyB0eXBlOiBCb29sZWFuLCBkZWZhdWx0OiBmYWxzZSB9LFxuICBjcmVhdGVkQXQ6IHsgdHlwZTogRGF0ZSwgZGVmYXVsdDogRGF0ZS5ub3cgfSxcbiAgdmFsaWRhdGVkQXQ6IHsgdHlwZTogRGF0ZSB9XG59KTtcblxuY29uc3QgdXNlclNjaGVtYSA9IG5ldyBtb25nb29zZS5TY2hlbWEoe1xuICB0ZWxlZ3JhbUlkOiB7XG4gICAgdHlwZTogTnVtYmVyLFxuICAgIHJlcXVpcmVkOiB0cnVlXG4gIH0sXG4gIGZpcnN0TmFtZTogeyB0eXBlOiBTdHJpbmcgfSxcbiAgbGFzdE5hbWU6IHsgdHlwZTogU3RyaW5nIH0sXG4gIHVzZXJuYW1lOiB7IHR5cGU6IFN0cmluZyB9LFxuICBwaG90b1VybDogeyB0eXBlOiBTdHJpbmcgfSxcbiAgY2hhdElkOiB7IHR5cGU6IFN0cmluZyB9LFxuICB0aWNrZXRzOiB7IHR5cGU6IE51bWJlciwgZGVmYXVsdDogMCB9LFxuICB0b25vdENoYW5jZVRpY2tldHM6IHsgdHlwZTogTnVtYmVyLCBkZWZhdWx0OiAwIH0sXG4gIGJhbGFuY2U6IHsgdHlwZTogTnVtYmVyLCBkZWZhdWx0OiAwIH0sXG4gIHRvbkJhbGFuY2U6IHsgdHlwZTogTnVtYmVyLCBkZWZhdWx0OiAwIH0sXG4gIGxvY2FsZTogeyB0eXBlOiBTdHJpbmcsIGVudW06IFsnZW4nLCAncnUnXSwgZGVmYXVsdDogJ2VuJyB9LFxuICAvLyDQoNC10YTQtdGA0LDQu9GM0L3QsNGPINGB0LjRgdGC0LXQvNCwXG4gIHJlZmVycmFsQ29kZToge1xuICAgIHR5cGU6IFN0cmluZ1xuICB9LFxuICByZWZlcnJlZEJ5OiBbe1xuICAgIHVzZXJJZDogeyB0eXBlOiBTdHJpbmcsIHJlcXVpcmVkOiB0cnVlIH0sXG4gICAgZGF0ZTogeyB0eXBlOiBEYXRlLCBkZWZhdWx0OiBEYXRlLm5vdyB9XG4gIH1dLFxuICByZWZlcnJhbHM6IFtyZWZlcnJhbFNjaGVtYV0sXG4gIGJvbnVzZXNSZWNlaXZlZDogeyB0eXBlOiBOdW1iZXIsIGRlZmF1bHQ6IDAgfSxcbiAgdG90YWxWYWxpZFJlZmVycmFsczogeyB0eXBlOiBOdW1iZXIsIGRlZmF1bHQ6IDAgfSxcbiAgcGVuZGluZ0JvbnVzZXM6IHsgdHlwZTogTnVtYmVyLCBkZWZhdWx0OiAwIH0sXG4gIGNoYW5uZWxTdWJzY3JpYmVkOiB7IHR5cGU6IEJvb2xlYW4sIGRlZmF1bHQ6IGZhbHNlIH0sXG4gIC8vINCY0YHRgtC+0YDQuNGPXG4gIHB1cmNoYXNlSGlzdG9yeTogW3B1cmNoYXNlSGlzdG9yeVNjaGVtYV0sXG4gIGdhbWVIaXN0b3J5OiBbZ2FtZUhpc3RvcnlTY2hlbWFdLFxuICBjcmVhdGVkQXQ6IHsgdHlwZTogRGF0ZSwgZGVmYXVsdDogRGF0ZS5ub3cgfSxcbiAgdXBkYXRlZEF0OiB7IHR5cGU6IERhdGUsIGRlZmF1bHQ6IERhdGUubm93IH1cbn0sIHsgdGltZXN0YW1wczogdHJ1ZSwgY29sbGVjdGlvbjogJ3VzZXJzJyB9KTtcblxuLy8g0JLRgdC1INC40L3QtNC10LrRgdGLINC+0L/RgNC10LTQtdC70Y/QtdC8INGP0LLQvdC+XG51c2VyU2NoZW1hLmluZGV4KHsgdGVsZWdyYW1JZDogMSB9LCB7IHVuaXF1ZTogdHJ1ZSB9KTtcbnVzZXJTY2hlbWEuaW5kZXgoeyByZWZlcnJhbENvZGU6IDEgfSwgeyB1bmlxdWU6IHRydWUgfSk7XG51c2VyU2NoZW1hLmluZGV4KHsgcmVmZXJyZWRCeTogMSB9KTtcblxuLy8g0J7QsdC90L7QstC70LXQvdC40LUg0LTQsNGC0Ysg0L/RgNC4INC40LfQvNC10L3QtdC90LjQuCDQtNC+0LrRg9C80LXQvdGC0LBcbnVzZXJTY2hlbWEucHJlKCdzYXZlJywgZnVuY3Rpb24obmV4dCkge1xuICB0aGlzLnVwZGF0ZWRBdCA9IG5ldyBEYXRlKCk7XG4gIGNvbnNvbGUubG9nKCdbVXNlck1vZGVsXSBwcmUtc2F2ZSBob29rINCy0YvQt9Cy0LDQvSDQtNC70Y8g0L/QvtC70YzQt9C+0LLQsNGC0LXQu9GPINGBIHRlbGVncmFtSWQ6JywgdGhpcy50ZWxlZ3JhbUlkKTtcbiAgbmV4dCgpO1xufSk7XG5cbi8vINCc0LXRgtC+0LTRiyDQtNC70Y8g0YDQsNCx0L7RgtGLINGBINGA0LXRhNC10YDQsNC70LDQvNC4XG51c2VyU2NoZW1hLm1ldGhvZHMgPSB7XG4gIC8qKlxuICAgKiDQlNC+0LHQsNCy0LvRj9C10YIg0L3QvtCy0L7Qs9C+INGA0LXRhNC10YDQtdGA0LBcbiAgICovXG4gIGFzeW5jIGFkZFJlZmVyZXIocmVmZXJlcklkKSB7XG4gICAgLy8g0J/RgNC+0LLQtdGA0Y/QtdC8LCDRgdGD0YnQtdGB0YLQstGD0LXRgiDQu9C4INGD0LbQtSDRgtCw0LrQvtC5INGA0LXRhNC10YDQtdGAXG4gICAgY29uc3QgZXhpc3RpbmdSZWZlcmVyID0gdGhpcy5yZWZlcnJlZEJ5Py5maW5kKHJlZiA9PiByZWYudXNlcklkID09PSByZWZlcmVySWQpO1xuICAgIGlmIChleGlzdGluZ1JlZmVyZXIpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICAvLyDQlNC+0LHQsNCy0LvRj9C10Lwg0L3QvtCy0L7Qs9C+INGA0LXRhNC10YDQtdGA0LBcbiAgICBpZiAoIXRoaXMucmVmZXJyZWRCeSkge1xuICAgICAgdGhpcy5yZWZlcnJlZEJ5ID0gW107XG4gICAgfVxuICAgIFxuICAgIHRoaXMucmVmZXJyZWRCeS5wdXNoKHtcbiAgICAgIHVzZXJJZDogcmVmZXJlcklkLFxuICAgICAgZGF0ZTogbmV3IERhdGUoKVxuICAgIH0pO1xuICAgIFxuICAgIGF3YWl0IHRoaXMuc2F2ZSgpO1xuICAgIHJldHVybiB0cnVlO1xuICB9LFxuXG4gIC8qKlxuICAgKiDQn9GA0L7QstC10YDRj9C10YIsINGP0LLQu9GP0LXRgtGB0Y8g0LvQuCDQv9C+0LvRjNC30L7QstCw0YLQtdC70Ywg0YDQtdGE0LXRgNCw0LvQvtC8INC00LvRjyDRg9C60LDQt9Cw0L3QvdC+0LPQviDRgNC10YTQtdGA0LXRgNCwXG4gICAqL1xuICBpc1JlZmVycmFsT2YocmVmZXJlcklkKSB7XG4gICAgcmV0dXJuIHRoaXMucmVmZXJyZWRCeT8uc29tZShyZWYgPT4gcmVmLnVzZXJJZCA9PT0gcmVmZXJlcklkKSB8fCBmYWxzZTtcbiAgfVxufTtcblxuLy8g0KHQvtC30LTQsNC10Lwg0LzQvtC00LXQu9GMINGC0L7Qu9GM0LrQviDQtdGB0LvQuCDQvtC90LAg0LXRidC1INC90LUg0YHRg9GJ0LXRgdGC0LLRg9C10YJcbmNvbnNvbGUubG9nKCdbVXNlck1vZGVsXSDQn9GA0L7QstC10YDQutCwINGB0YPRidC10YHRgtCy0L7QstCw0L3QuNGPINC80L7QtNC10LvQuCBVc2VyLi4uJyk7XG5jb25zdCBtb2RlbEV4aXN0cyA9IG1vbmdvb3NlLm1vZGVscy5Vc2VyICE9PSB1bmRlZmluZWQ7XG5jb25zb2xlLmxvZygnW1VzZXJNb2RlbF0g0JzQvtC00LXQu9GMIFVzZXIg0YHRg9GJ0LXRgdGC0LLRg9C10YI6JywgbW9kZWxFeGlzdHMpO1xuXG4vLyDQr9Cy0L3QviDRg9C60LDQt9GL0LLQsNC10Lwg0LrQvtC70LvQtdC60YbQuNGOIFwidXNlcnNcIiDQuCDQsdCw0LfRgyDQtNCw0L3QvdGL0YUg0YfQtdGA0LXQtyDQvtC/0YbQuNC4XG5jb25zdCBVc2VyID0gbW9uZ29vc2UubW9kZWxzLlVzZXIgfHwgbW9uZ29vc2UubW9kZWwoJ1VzZXInLCB1c2VyU2NoZW1hLCAndXNlcnMnKTtcblxuY29uc29sZS5sb2coJ1tVc2VyTW9kZWxdINCc0L7QtNC10LvRjCBVc2VyINC40L3QuNGG0LjQsNC70LjQt9C40YDQvtCy0LDQvdCwJyk7XG5jb25zb2xlLmxvZygnW1VzZXJNb2RlbF0g0JjQvNGPINC60L7Qu9C70LXQutGG0LjQuDonLCBVc2VyLmNvbGxlY3Rpb24/Lm5hbWUgfHwgJ9Cd0LXQuNC30LLQtdGB0YLQvdC+Jyk7XG5cbmV4cG9ydCBkZWZhdWx0IFVzZXI7ICJdLCJuYW1lcyI6WyJtb25nb29zZSIsImNvbnNvbGUiLCJsb2ciLCJwdXJjaGFzZUhpc3RvcnlTY2hlbWEiLCJTY2hlbWEiLCJkYXRlIiwidHlwZSIsIkRhdGUiLCJkZWZhdWx0Iiwibm93IiwiYW1vdW50IiwiTnVtYmVyIiwicmVxdWlyZWQiLCJ0aWNrZXRzIiwidHJhbnNhY3Rpb25JZCIsIlN0cmluZyIsImdhbWVIaXN0b3J5U2NoZW1hIiwibWF0Y2hJZCIsIm9wcG9uZW50SWQiLCJvcHBvbmVudE5hbWUiLCJyZXN1bHQiLCJlbnVtIiwidG9ub3RDaGFuY2VUaWNrZXRzIiwicmVmZXJyYWxTY2hlbWEiLCJ1c2VySWQiLCJ1c2VybmFtZSIsInBob3RvVXJsIiwiaGFzUGxheWVkUm9vbUEiLCJCb29sZWFuIiwiaGFzUGxheWVkUm9vbUIiLCJpc1ZhbGlkIiwiY3JlYXRlZEF0IiwidmFsaWRhdGVkQXQiLCJ1c2VyU2NoZW1hIiwidGVsZWdyYW1JZCIsImZpcnN0TmFtZSIsImxhc3ROYW1lIiwiY2hhdElkIiwiYmFsYW5jZSIsInRvbkJhbGFuY2UiLCJsb2NhbGUiLCJyZWZlcnJhbENvZGUiLCJyZWZlcnJlZEJ5IiwicmVmZXJyYWxzIiwiYm9udXNlc1JlY2VpdmVkIiwidG90YWxWYWxpZFJlZmVycmFscyIsInBlbmRpbmdCb251c2VzIiwiY2hhbm5lbFN1YnNjcmliZWQiLCJwdXJjaGFzZUhpc3RvcnkiLCJnYW1lSGlzdG9yeSIsInVwZGF0ZWRBdCIsInRpbWVzdGFtcHMiLCJjb2xsZWN0aW9uIiwiaW5kZXgiLCJ1bmlxdWUiLCJwcmUiLCJuZXh0IiwibWV0aG9kcyIsImFkZFJlZmVyZXIiLCJyZWZlcmVySWQiLCJleGlzdGluZ1JlZmVyZXIiLCJmaW5kIiwicmVmIiwicHVzaCIsInNhdmUiLCJpc1JlZmVycmFsT2YiLCJzb21lIiwibW9kZWxFeGlzdHMiLCJtb2RlbHMiLCJVc2VyIiwidW5kZWZpbmVkIiwibW9kZWwiLCJuYW1lIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./src/models/User.js\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Ftelegram-user%2Froute&page=%2Fapi%2Ftelegram-user%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Ftelegram-user%2Froute.ts&appDir=C%3A%5CUsers%5Cconst%5CDesktop%5Ctonotchance-main%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5Cconst%5CDesktop%5Ctonotchance-main&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();